<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5de42d6f490bd156c597.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">Deploying a simple NodeJS App in kubernetes - Personal Blog</title><meta data-react-helmet="true" name="description" content="Steps on how to deploy simple NodeJS app, connected to a MongoDB host and exposing its endpoints through a Kubernetes service."/><meta data-react-helmet="true" property="og:title" content="Deploying a simple NodeJS App in kubernetes - Personal Blog"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="Steps on how to deploy simple NodeJS app, connected to a MongoDB host and exposing its endpoints through a Kubernetes service."/><meta data-react-helmet="true" property="og:url" content="https://alesancor1.github.io/simple-app-kubernetes/"/><meta data-react-helmet="true" name="twitter:label1" content="Written by"/><meta data-react-helmet="true" name="twitter:data1" content="alesancor1"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="alesancor1"/><meta data-react-helmet="true" name="twitter:title" content="Deploying a simple NodeJS App in kubernetes - Personal Blog"/><meta data-react-helmet="true" name="twitter:description" content="Steps on how to deploy simple NodeJS app, connected to a MongoDB host and exposing its endpoints through a Kubernetes service."/><meta data-react-helmet="true" name="keywords" content="Students,  Developers, Researchers, Software Engineering, everyone, Guide, Mid-level, Kubernetes"/><meta data-react-helmet="true" name="article:published_time" content="2022-11-06T15:25:00.000Z"/><meta data-react-helmet="true" name="article:modified_time" content="2022-11-06T00:00:00.000Z"/><meta data-react-helmet="true" name="twitter:label2" content="Filed under"/><meta data-react-helmet="true" name="twitter:data2" content="Guide"/><meta data-react-helmet="true" property="og:image" content="https://alesancor1.github.io/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png"/><meta data-react-helmet="true" name="twitter:image" content="https://alesancor1.github.io/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png"/><script data-react-helmet="true" type="application/ld+json">
        {
          "@context": "https://schema.org/",
          "@type": "Article",
          "author": {
            "@type": "Person",
            "name": "alesancor1"
          },
          "keywords": "Guide, Mid-level, Kubernetes",
          "headline": "Deploying a simple NodeJS App in kubernetes - Personal Blog",
          "url": "https://alesancor1.github.io/simple-app-kubernetes/",
          "datePublished": "2022-11-06T15:25:00.000Z",
          "dateModified": "2022-11-06T00:00:00.000Z",
          "image": {
            "@type": "ImageObject",
            "url": "https://alesancor1.github.io/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png",
            "width": "1000",
            "height": "520"
          },
          "publisher": {
            "@type": "Organization",
            "name": "Personal Blog"
          },
          "description": "Steps on how to deploy simple NodeJS app, connected to a MongoDB host and exposing its endpoints through a Kubernetes service.",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://alesancor1.github.io"
          }
        }
      </script><style data-styled="bzOPpS kHKWRw fNaZYs gGoecn jLOYBk fVqyTA cROOCp gWrDHi MQpwo llwmof fYiJFa JoeLU gINVKO vNDEa gkyoqc lhFcmu knvKPj jAIPIr ihzMDK cxFkWP ccWeoH xRPUr bKAqcy cYqZmU bICWKm ghlSja jAnmWt fZmyke iHGPyz lfACiL lbetsi YZAaE hLhzMS gpDhwt ctpkkx etXHUJ dLTgSL cXOFUh bqPxdl" data-styled-version="4.4.1">
/* sc-component-id: sc-global-2089182736 */
html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} main{display:block;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} img{border-style:none;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} html{box-sizing:border-box;background-color:#fafafa;} body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;line-height:1.9em;} *{box-sizing:border-box;} h1,h2,h3,h4,h5,h6{outline:none;} a{color:#000;-webkit-text-decoration:none;text-decoration:none;} .gatsby-highlight{max-width:100% !important;} .gatsby-highlight-code-line{background-color:#353631;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;}
/* sc-component-id: style__NavContainer-sc-1ck1w82-0 */
.bzOPpS{z-index:1000;background-color:#20232a;position:-webkit-sticky;position:sticky;top:0;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.07);}
/* sc-component-id: style__Nav-sc-1ck1w82-1 */
.kHKWRw{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;} @media (max-width:1300px){.kHKWRw{padding:0 20px;}}
/* sc-component-id: style__NavWrapper-sc-1ck1w82-2 */
.jLOYBk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;height:70px;white-space:nowrap;} @media (max-width:576px){.jLOYBk{width:90%;}}
/* sc-component-id: style__NavMenu-sc-1ck1w82-3 */
.fVqyTA{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;list-style-type:none;margin:0;padding:0;} @media (max-width:576px){.fVqyTA{width:80%;overflow-x:auto;overflow-y:hidden;-webkit-mask-image:linear-gradient(to right,transparent,#000 25px,#000 90%,transparent);mask-image:linear-gradient(to right,transparent,#000 25px,#000 90%,transparent);}}.cROOCp{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;list-style-type:none;margin:0;padding:0;}
/* sc-component-id: style__NavMenuItem-sc-1ck1w82-4 */
.gWrDHi{cursor:pointer;display:inline-block;border:0;background:transparent;outline:none;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: style__NavLink-sc-1ck1w82-5 */
.MQpwo{color:#fff;opacity:.8;padding:16px;-webkit-transition:opacity .5s;transition:opacity .5s;} .MQpwo:hover{opacity:1;}
/* sc-component-id: style__SearchContainer-sc-1ck1w82-6 */
.llwmof{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;position:relative;}
/* sc-component-id: style__ToggleSearchButton-sc-1ck1w82-7 */
.fYiJFa{cursor:pointer;color:#fff;opacity:.8;background:none;outline:none;border:0;-webkit-transition:opacity .5s;transition:opacity .5s;} .fYiJFa:hover{opacity:1;}
/* sc-component-id: logo__LogoImage-sc-75wnhe-0 */
.gGoecn{max-height:30px;width:30px;margin-right:45px;} @media (max-width:576px){.gGoecn{margin-right:15px;}}
/* sc-component-id: logo__HomeLink-sc-75wnhe-1 */
.fNaZYs{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;height:30px;}
/* sc-component-id: style__StyledFooter-sc-1oqvjzu-0 */
.gpDhwt{max-width:100%;padding:10px 0;z-index:700;position:relative;font-size:.9em;margin-top:50px;}
/* sc-component-id: style__FooterContainer-sc-1oqvjzu-1 */
.ctpkkx{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;text-align:right;line-height:1.1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;} @media (max-width:1300px){.ctpkkx{padding:0 20px;}}
/* sc-component-id: style__Copyright-sc-1oqvjzu-2 */
.cXOFUh{margin:0;}
/* sc-component-id: style__DesignBy-sc-1oqvjzu-3 */
.bqPxdl{margin:0;opacity:.8;font-size:.8em;} .bqPxdl a{font-weight:bold;-webkit-text-decoration:none;text-decoration:none;color:#000;} .bqPxdl a:hover{-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: style__StyledNav-sc-1oqvjzu-4 */
.etXHUJ ul{list-style-type:none;margin:0;padding:0;} .etXHUJ li{display:inline-block;margin-right:25px;} .etXHUJ li:last-child{margin-right:0;}
/* sc-component-id: style__FooterMenuLink-sc-1oqvjzu-6 */
.dLTgSL{color:#000;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: toc__StyledNav-sc-1hwup8p-0 */
.lhFcmu .toc-list{list-style-type:none;margin:0;padding:0;} .lhFcmu .toc-list .toc-list{padding-left:17px;padding-top:10px;} .lhFcmu .toc-list-item{line-height:1.2em;padding-bottom:10px;} .lhFcmu .toc-list-item:last-child{padding-bottom:0;} .lhFcmu .toc-link{color:#808080;-webkit-text-decoration:none;text-decoration:none;} .lhFcmu .is-active-link{color:#404040;font-weight:700;}
/* sc-component-id: reading-progress__ReadingProgressBar-sc-vxjjnv-0 */
.JoeLU{position:-webkit-sticky;position:sticky;height:5px;top:70px;background-color:#007acc;z-index:500;}
/* sc-component-id: social-channel-list__StyledSocialChannels-sc-16w9pwh-0 */
.YZAaE{list-style-type:none;margin:0;padding:0;}
/* sc-component-id: social-channel-list__StyledSocialChannel-sc-16w9pwh-1 */
.hLhzMS{display:inline-block;margin:0 10px;font-size:1.6em;opacity:.7;-webkit-transition:opacity .5s;transition:opacity .5s;} .hLhzMS:hover{opacity:1;}
/* sc-component-id: bio__StyledBio-sc-19adui4-0 */
.iHGPyz{margin:auto;text-align:center;width:100%;}
/* sc-component-id: bio__AuthorDescription-sc-19adui4-1 */
.lbetsi{margin:10px 0 13px;} .lbetsi a{color:#000;-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: bio__AuthorName-sc-19adui4-2 */
.lfACiL{margin:10px;}
/* sc-component-id: post__PostContainer-sc-h8gzap-0 */
.gINVKO{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:0 !important;} @media (max-width:1300px){.gINVKO{padding:0 20px;}}
/* sc-component-id: post__LeftSidebar-sc-h8gzap-1 */
.vNDEa{min-width:255px;max-width:225px;-webkit-transition:opacity .5s,z-index .5s;transition:opacity .5s,z-index .5s;} @media (max-width:1300px){.vNDEa{position:fixed;opacity:0;z-index:-1;background-color:#fff;width:100% !important;max-width:100%;padding:0 20px;margin-top:-5px;height:calc(100vh - 70px);}}
/* sc-component-id: post__PostContent-sc-h8gzap-2 */
.jAIPIr{margin-top:-5px;border-right:1px #e5eff5 solid;border-left:1px #e5eff5 solid;background-color:#fff;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.1);z-index:10;width:1035px;max-width:100%;} .jAIPIr li > a,.jAIPIr p > a{color:#11ABB6;border-bottom:2px #11ABB6 solid;} .jAIPIr pre{margin:30px 0;} .jAIPIr blockquote{border-left:4px #11ABB6 solid;background-color:#fafafa;margin:30px 0;padding:5px 20px;border-radius:.3em;} .jAIPIr h3::before,.jAIPIr h4::before,.jAIPIr h5::before,.jAIPIr h6::before{display:block;content:" ";height:90px;margin-top:-90px;visibility:hidden;} .jAIPIr h2{border-top:1px solid #ececec;margin-top:44px;padding-top:40px;line-height:1.2;} .jAIPIr code[class*="language-text"]{padding:5px;} .jAIPIr p > img{max-width:100%;border-radius:.3em;margin:30px 0;} .jAIPIr hr{border-top:1px solid #ececec;border-bottom:0;margin-top:44px;margin-bottom:40px;} .jAIPIr .gatsby-resp-image-link{margin:30px 0;max-width:100%;} .jAIPIr .gatsby-resp-image-link .gatsby-resp-image-image{border-radius:.3em;}
/* sc-component-id: post__TocWrapper-sc-h8gzap-3 */
.gkyoqc{position:-webkit-sticky;position:sticky;top:70px;padding:40px 30px 40px 0;}
/* sc-component-id: post__PostHeader-sc-h8gzap-4 */
.ihzMDK{padding:40px;} @media (max-width:576px){.ihzMDK{padding:20px;}}
/* sc-component-id: post__FeaturedImage-sc-h8gzap-5 */
.xRPUr{border-radius:0;} @media (max-width:1300px){.xRPUr{margin-left:-1px;margin-right:-1px;}}
/* sc-component-id: post__StyledPost-sc-h8gzap-6 */
.bKAqcy{padding:40px;} @media (max-width:576px){.bKAqcy{padding:20px;}}
/* sc-component-id: post__PostMeta-sc-h8gzap-7 */
.cxFkWP{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;opacity:.8;font-size:.9em;}
/* sc-component-id: post__PostTitle-sc-h8gzap-8 */
.ccWeoH{margin:0;padding:0;}
/* sc-component-id: post__PostFooter-sc-h8gzap-9 */
.cYqZmU{background-color:#fafafa;font-size:.8em;color:#666;padding:40px;line-height:1em;} .cYqZmU p{margin:5px 0;}
/* sc-component-id: post__FooterTagLink-sc-h8gzap-10 */
.bICWKm{color:#000 !important;-webkit-text-decoration:none;text-decoration:none;border-bottom:0 !important;}
/* sc-component-id: post__PostAddition-sc-h8gzap-11 */
.ghlSja{background-color:#fff;border-top:1px #e5eff5 solid;border-bottom:1px #e5eff5 solid;z-index:700;position:relative;padding:40px;}
/* sc-component-id: post__PostAdditionContent-sc-h8gzap-12 */
.jAnmWt{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;} @media (max-width:1300px){.jAnmWt{padding:0 20px;}}
/* sc-component-id: post__BioWrapper-sc-h8gzap-13 */
.fZmyke{width:50%;margin:auto;} @media (max-width:576px){.fZmyke{width:100%;}}
/* sc-component-id: post__ToggleTocButton-sc-h8gzap-14 */
.knvKPj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:fixed;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;right:20px;bottom:20px;border-radius:100%;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.1);border:0;z-index:5000;width:50px;height:50px;background-color:#20232a;color:#fff;outline:none;} @media (min-width:1300px){.knvKPj{display:none;}}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=aa125c22ab74279b6bcaff331ccf6be3" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#11ABB6"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=aa125c22ab74279b6bcaff331ccf6be3"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-a6fb0571f21923dc760f.js"/><link as="script" rel="preload" href="/framework-999a01e9e4c894cffffe.js"/><link as="script" rel="preload" href="/app-2739c70ed76892e353dc.js"/><link as="script" rel="preload" href="/styles-7d4153d260c0197f0043.js"/><link as="script" rel="preload" href="/1bfc9850-3de49fcd9cce71919e67.js"/><link as="script" rel="preload" href="/commons-2b189c38f90eef275b71.js"/><link as="script" rel="preload" href="/component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx-3b2e3e21f50839ebc5db.js"/><link as="fetch" rel="preload" href="/page-data\simple-app-kubernetes\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1116962356.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2275848304.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/545095672.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/625280739.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data\app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="style__NavContainer-sc-1ck1w82-0 bzOPpS"><div class="common__Container-sc-1d5kp8-0 style__Nav-sc-1ck1w82-1 kHKWRw"><a class="logo__HomeLink-sc-75wnhe-1 fNaZYs" href="/"><div class="logo__LogoImage-sc-75wnhe-0 gGoecn gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:30px;height:30px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFlUlEQVQ4y1VV609Tdxh+W3HsJmRBRTOnQZNl88Mic8qXbSYLGm8wgkjLpaUtvUgpvdJSREDxBlUuDjoBKaWUXuhpe04vp+3plUKBgRc0miwuWbKP+xf2ib3FZct+yZOek9PzvJfnfZ8D8M/pX38Jt56+QbyGm3itjq6AMb0JPdnnIHTTwHcGQRXNQQezhliFm5uvoS/3HPpXX0Dv8lP431FQSWicI+HHCQc0zPqAO0fuMqQ3YHt7G0k3CmX+xHGxjynXJdeL+7d+g67lZ8C1+thCT5TFsVHQ5KRBGcq8I+PcGgaxJwr8hSA02UiWyBWGeiTNkwndERC5Y5WXJhbGzg1bBnhOWiNYjMCnoh4WB/8jImIgcEfYCJAHMiDGe+Df/wkJ8YEzzG5xhEBOJve3uGjt8Ns/irpTq8UNc6S5apo4WmXxQLMjZJYFUuVw+ioIXHSrlExUSHxxQLB10VUQeeMAzfcegdTLsHSxHOiZ1QNVE/bBi49sQt5C4MHF4Zn+k4bBCsyWlc/4u/uTZbXTi9oGq2/88phVIHDSDzrC2VP5fqvoLEuM5NB0ZzRfLptnDwB/nuI020hj7dQiwJdnC2XOYIlgIVBfO+k01D1Z7BK4wtLu5PoR1lnehzxskdBF/9A0H7jNtweBbw+xOTYS4H72GVxHUdqpTIGU2YR2X9zUYPUfGshsHGm2EKPnh6bOndDd21fCVe6pNjtOStyRISOTu1A16QG5Lz564eFMSam4G2SeGMsYXwMw5bZ2xFEH0jD++vcPuFZyoGZ6sQQzHSnX3N3XNOOBY7IeHKVXe0WY1cNXb0HuZQY7gukvFL64XBvNfdNBpWAAE9shHN14kyfdrQmk6/EFMyp6RuFPVF2ZIWryBEp//IzUTVfL/QmTNpiua3WGQeyOlCkDae01L/MZZjzbQSZFSHawO7EO0BXOwvXIcpmCYB59rbtTJCUzoKFSXVIXXdobXeHKFoIquZs+qSJT13RU8uKNWG5gkFkuMNLLRg2Z2oPFsXSBtL4ztFSFANCQSdAFUkcV3vhYd+7FR43THtBSaSNGLjVQSa4+mFbq6eUqBZms0fjjl9rdkd4bzEqBNrTUJXJG9sCxStCHl3RKMlmFQQEafl4A0Yxnt9Ae4KiolNlAZ79X+RPVhtBSjQGnX+wInGr3MuNSIlqDIl0aXN2CgczmEbkvoe5LbxzQBDPTgnmq9eoMceDKNE4Hb9q9sxXtOOU9nujHNyLLA73hTElvJDtiyj7bq/LHQWolio43qXa1EVH4SjcERjp7W+IMf96XWGuVe2KnUST41vQE6i1eAKGFgDZcJ7EjVMAdtUGbJ2pqsvgOqd3hMuzZqDacqexbf1U89PJtsZZeOoEBbots5HmelQIVmRxRhzL7FaiDyEWz8j4ALSYztHkZNgLaiBinxR4woOKwub39nmSe3CuwkxyZN6aXEVEd3+aXVA9bDif/2n5fE0xDO06A3J+8pw6ikMEMe2eXa3tNIHeFWRI7Ba028mBXMD3YFc7w1P7E0HU62ze4snUqr2Qe489/PdzD5No7g+lHPbFcC4pxp2WOPC3GTZE6wqz6GQLdZmAE5FiywhNld2CPFO5wqcwR0lV0PyySWBY/UZNJs9yfOtpgWQQllRoXzpEn/sSeK4hYq8BGVbShsWDp7N7ELzsWCJe77kI72pcSS1b5GJYGSTvyqePJ/yo8sUpdKD1siGR7cS3VndiONTQLLW4HCgM41Gx9ZAX0aC51k+53niiZJUDjY8AYSoPOz+QD7KqbsAMUluAUOAulC9RxNIpyzmNHcaPdB3yrF7AlbJkrwupEMh29DLVjNiirFv3n2lzzAgjmfDu4+pMNhFYCmqcc0PjYDm0u9MlFGrhTTmjFT0Eezbjjl03TUDMyC+fvmv8l+xtDmeN6edJnrgAAAABJRU5ErkJggg==" alt="Personal Blog" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/aa125c22ab74279b6bcaff331ccf6be3/91664/logo.png 1x,
/static/aa125c22ab74279b6bcaff331ccf6be3/ad39b/logo.png 1.5x,
/static/aa125c22ab74279b6bcaff331ccf6be3/183c2/logo.png 2x" /><img loading="lazy" width="30" height="30" srcset="/static/aa125c22ab74279b6bcaff331ccf6be3/91664/logo.png 1x,
/static/aa125c22ab74279b6bcaff331ccf6be3/ad39b/logo.png 1.5x,
/static/aa125c22ab74279b6bcaff331ccf6be3/183c2/logo.png 2x" src="/static/aa125c22ab74279b6bcaff331ccf6be3/91664/logo.png" alt="Personal Blog" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></a><div class="style__NavWrapper-sc-1ck1w82-2 jLOYBk"><ul class="style__NavMenu-sc-1ck1w82-3 fVqyTA"><li class="style__NavMenuItem-sc-1ck1w82-4 gWrDHi"><a class="style__NavLink-sc-1ck1w82-5 MQpwo" href="/">Home</a></li><li class="style__NavMenuItem-sc-1ck1w82-4 gWrDHi"><a class="style__NavLink-sc-1ck1w82-5 MQpwo" href="/archive">Posts</a></li><li class="style__NavMenuItem-sc-1ck1w82-4 gWrDHi"><a class="style__NavLink-sc-1ck1w82-5 MQpwo" href="/tags">Tags</a></li></ul><div class="style__SearchContainer-sc-1ck1w82-6 llwmof"><ul class="style__NavMenu-sc-1ck1w82-3 cROOCp"><li class="style__NavMenuItem-sc-1ck1w82-4 gWrDHi"><button role="button" aria-label="Toggle search" class="style__ToggleSearchButton-sc-1ck1w82-7 fYiJFa"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg></button></li></ul></div></div></div></div><main><div style="width:0%" color="#007acc" class="reading-progress__ReadingProgressBar-sc-vxjjnv-0 JoeLU"></div><div class="common__Container-sc-1d5kp8-0 post__PostContainer-sc-h8gzap-0 gINVKO"><div class="post__LeftSidebar-sc-h8gzap-1 vNDEa"><div class="post__TocWrapper-sc-h8gzap-3 gkyoqc"><nav class="toc__StyledNav-sc-1hwup8p-0 lhFcmu toc"></nav></div></div><button role="button" aria-label="Toggle table of contents" class="post__ToggleTocButton-sc-h8gzap-14 knvKPj"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></svg></button><div class="post__PostContent-sc-h8gzap-2 jAIPIr"><article class="post"><header class="post__PostHeader-sc-h8gzap-4 ihzMDK"><section class="post__PostMeta-sc-h8gzap-7 cxFkWP"><a href="/tag/guide">Guide</a><time dateTime="2022-11-06T15:25:00.000Z">06 November, 2022</time></section><h1 class="post__PostTitle-sc-h8gzap-8 ccWeoH">Deploying a simple NodeJS App in kubernetes</h1></header><div class="post__FeaturedImage-sc-h8gzap-5 xRPUr gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:47%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVQoz2PI3u+OibL2uyXutm48kTT/akfyHtuMfc45+z0wlTGg8YGKMve5tJ3OWH172q5Hq44937np3vyZlxvyDngBTcSl2SP3gGfuAa+8gz5pex17zxaee3Vw+qW6pdf7N96Zt/PhytQ99kApoAKgsmyYKxjAfC8gK32vE1BF6l77hF2Wq29NW3Vr2rmXhx59urP67rSdD1aUHQkBeiRljz1QGVAxRBdDyh47oFDBQb/Gk8nTLtVsuDvvyttT3359/ff33////798+3Tp/OV///7d/3h924MlQPc3nUwpOOgL1mXHsO3+kktvTjz/8vDHn2//weDXr19TJ02fu276gnNTZsycWVRU1Nnd+fzZc5Dcv/8///x4/vXhxddHgWHB8B8J/P33Byj/7fvXG9dvnr12eu2FZSs2Ltu3b//uvbu+/fj27/9fiAK4egYgH4yArkSIQtgvP768+eL6f3QAVPoXoovhPzbwFwj+/f3z9/fvP7+BHgbysCoDAEnUiX1fWTlwAAAAAElFTkSuQmCC" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/6377120ee106e93bf8074fa36b79a901/dc47e/cover.png 200w,
/static/6377120ee106e93bf8074fa36b79a901/9f2d5/cover.png 400w,
/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png 800w,
/static/6377120ee106e93bf8074fa36b79a901/77647/cover.png 1200w,
/static/6377120ee106e93bf8074fa36b79a901/f8d4f/cover.png 1600w,
/static/6377120ee106e93bf8074fa36b79a901/09911/cover.png 2800w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="/static/6377120ee106e93bf8074fa36b79a901/dc47e/cover.png 200w,
/static/6377120ee106e93bf8074fa36b79a901/9f2d5/cover.png 400w,
/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png 800w,
/static/6377120ee106e93bf8074fa36b79a901/77647/cover.png 1200w,
/static/6377120ee106e93bf8074fa36b79a901/f8d4f/cover.png 1600w,
/static/6377120ee106e93bf8074fa36b79a901/09911/cover.png 2800w" src="/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><section class="post__StyledPost-sc-h8gzap-6 bKAqcy post"><style>
    summary {
        cursor: pointer;
    }
</style>
<blockquote>
<p><strong>NOTE</strong>: This guide will assume you have a basic understanding of Kubernetes and know how to run and manage a cluster. If you haven't already read my post about <a href="/kubernetes-fundamentals">Kubernetes fundamentals</a>, I encourage you to read it first.</p>
<p>All the code in this guide is available on <a href="https://github.com/alesancor1/Blog-Projects/tree/main/guides/simple-app-kubernetes">GitHub</a></p>
</blockquote>
<h2 id="introduction" style="position:relative;"><a href="#introduction" aria-label="introduction permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>For this guide, we will be deploying the simple NodeJS we build in a previous post, feel free to go <a href="/create-simple-app">check it out</a> first. We will go through all the steps to set up our simple NodeJS app inside a Kubernetes cluster.</p>
<blockquote>
<p>This guide is parallel to the <a href="/simple-app-helm">Creating a Helm Chart for a simple NodeJS App</a> guide, so you can open both posts and compare them, since both posts will follow the same exact structure.</p>
</blockquote>
<h2 id="creating-the-database-manifests" style="position:relative;"><a href="#creating-the-database-manifests" aria-label="creating the database manifests permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the Database manifests</h2>
<p>We will first write the database manifests files, starting by the service and then the pvc and finally the deployment. This order will be the same for the creation of the resources, since deployment depends on the pvc and the service needs to exist in order for the pods to be exposed by it.</p>
<h3 id="service" style="position:relative;"><a href="#service" aria-label="service permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Service</h3>
<p>Since we are deploying a MongoDB, we will set the service to use the default MongoDB port: <code class="language-text">27017</code>. This way, our manifest will have the same port and target port:</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># svc.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'27017'</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">27017</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db</code></pre></div>
</div></details>
<blockquote>
<p>This service will not be exposed to the outside world, all database connections will be managed internally through the <strong>kubernetes built-in DNS</strong>.</p>
</blockquote>
<h3 id="persistent-volume-claim" style="position:relative;"><a href="#persistent-volume-claim" aria-label="persistent volume claim permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Persistent Volume Claim</h3>
<p>For persistence, we will declare a <strong>PVC</strong> that claims a volume with 20Gi storage and <em>ReadWriteOnce</em> access mode:</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># pvc.yaml</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 20Gi</code></pre></div>
</div></details>
<blockquote>
<p>We will not create a persistent volume that matches this PVC, as mentioned in the <strong>Kubernetes Fundamentals</strong> post, we are letting de cluster <strong>dynamically provision</strong> the volume for us.</p>
</blockquote>
<h3 id="deployment" style="position:relative;"><a href="#deployment" aria-label="deployment permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment</h3>
<p>Once the service and PVC are created, we will now write the deployment manifest. The deployment will have the label <code class="language-text">app</code> to be matched by the service <strong>selector</strong>, and will mount a volume to the <code class="language-text">/data/db</code> container directory. This volume will reference our <strong>PVC</strong>:</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># deployment.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">27017</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data/db
              <span class="token key atrule">name</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>simple<span class="token punctuation">-</span>db<span class="token punctuation">-</span>data
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>simple<span class="token punctuation">-</span>db<span class="token punctuation">-</span>data
          <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
            <span class="token key atrule">claimName</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db</code></pre></div>
</div></details>
<h2 id="creating-the-app-manifests" style="position:relative;"><a href="#creating-the-app-manifests" aria-label="creating the app manifests permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the App manifests</h2>
<h3 id="service-1" style="position:relative;"><a href="#service-1" aria-label="service 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Service</h3>
<p>The deployment will be made for both <strong>local</strong> and <strong>production</strong> environments, so we will need to write a service that binds the ports of the cluster to our <strong>local machine</strong> ports.</p>
<p>Starting with the local service, we define it as a NodePort, which port and nodePort will be the same in which the app is running inside the container: <code class="language-text">3300</code>.</p>
<blockquote>
<p><strong>NOTE</strong>: Since the port <code class="language-text">3300</code> is not inside the default <strong>NodePort range</strong>, we will need to add the <code class="language-text">--node-port-range</code> flag to the kubeapi-server.yml file. As described in the <strong>Kubernetes Fundamentals</strong> post.</p>
</blockquote>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># svc-local.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3300</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">3300</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">3300</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app</code></pre></div>
</div></details>
<p>On the other hand, the production service will be set as <strong>ClusterIP</strong> (default) and exposed internally at port <code class="language-text">3300</code> too:</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># svc.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3300</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">3300</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app</code></pre></div>
</div></details>
<blockquote>
<p>The service port can actually be any, we will be using the same port for both environments.</p>
</blockquote>
<h3 id="deployment-1" style="position:relative;"><a href="#deployment-1" aria-label="deployment 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment</h3>
<p>Our app will run on the port <code class="language-text">3300</code> of the container. For that, we need to specify that port under the <code class="language-text">containerPort</code> field, apart from passing the <code class="language-text">PORT</code> environment variable to the container. We also have to make sure the labels specified in metadata are the same as the service selector.</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># deployment.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PORT
            <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"3300"</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_HOST
            <span class="token key atrule">value</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PORT
            <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"27017"</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_NAME
            <span class="token key atrule">value</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>db

          <span class="token key atrule">image</span><span class="token punctuation">:</span> alesancor1/simple<span class="token punctuation">-</span>app<span class="token punctuation">:</span>latest
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">3300</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 300Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 500Mi</code></pre></div>
</div></details>
<blockquote>
<p>Note that the <code class="language-text">DB_HOST</code> env variable is set the same as the name of the MongoDB service. This is because the cluster automatically provides service discovery through its <strong>internal DNS</strong>.</p>
</blockquote>
<h2 id="running-locally-on-a-single-node-cluster" style="position:relative;"><a href="#running-locally-on-a-single-node-cluster" aria-label="running locally on a single node cluster permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running locally on a single node cluster</h2>
<p>With all the manifests files created, we can now deploy the app to the cluster. We will start a single node cluster (<strong>Minikube</strong> or <strong>Docker k8s</strong>) and apply the manifests in the same order as this guide does. For that, use the <code class="language-text">-f</code> flag to specify the manifests files to be applied. Don't forget to create the namespace before applying the manifests.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ kubectl create namespace simple-app
$ kubectl apply -f &lt;file></code></pre></div>
<p>If you performed all the steps correctly (remember to run only local services manifests), you should be able to see the app running on <a href="http://localhost:3300">http://localhost:3300</a>.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d1f7d5ac4acebcb58c6854f4307e19ce/78363/result.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 12%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAc0lEQVQI1z2Kyw6CMBBF+VQlulAatOKGRXEhn6ppk05naPmAS7UNi5Oc+2ge0wxtZvTjC6fbE4frHcdOV7IrvedW1W73ks/9ADVOuJg3Gvv5QkQQF4GzFs5ZBKI/nPltzAwJITvX7wLyHkQeKca8l25NCRuLMHk2k5JCvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="result"
        title="result"
        src="/static/d1f7d5ac4acebcb58c6854f4307e19ce/c1b63/result.png"
        srcset="/static/d1f7d5ac4acebcb58c6854f4307e19ce/5a46d/result.png 300w,
/static/d1f7d5ac4acebcb58c6854f4307e19ce/0a47e/result.png 600w,
/static/d1f7d5ac4acebcb58c6854f4307e19ce/c1b63/result.png 1200w,
/static/d1f7d5ac4acebcb58c6854f4307e19ce/78363/result.png 1522w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2 id="production-environments-dns-and-tls-configuration" style="position:relative;"><a href="#production-environments-dns-and-tls-configuration" aria-label="production environments dns and tls configuration permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Production environments: DNS and TLS configuration</h2>
<p>For production environments, we will configure a DNS record pointing to the service. We will also configure a TLS certificate and a certificate signing request. For doing that, we will use <strong>Project Contour</strong> and <strong>Cert-Manager</strong> APIs, which simplifies the process. Since they are not native, first thing we need to do is installing them by running:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$    kubectl apply -f https://projectcontour.io/quickstart/contour.yaml
$    kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.1.0/cert-manager.yaml</code></pre></div>
<blockquote>
<p><strong>Project Contour</strong> provide a Load Balancer service that will be our reverse proxy. Be sure to obtain its <strong>external IP</strong> and configure an <strong>A record</strong> in your <strong>NS zone</strong> pointing to that IP. The External IP can be obtained running <code class="language-text">kubectl get -n projectcontour service envoy</code> (it takes a while to be ready).</p>
<p>Be sure to apply the local services manifests when deploying to production</p>
</blockquote>
<h3 id="issuer-and-clusterissuer" style="position:relative;"><a href="#issuer-and-clusterissuer" aria-label="issuer and clusterissuer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Issuer and ClusterIssuer</h3>
<p>Before validating TLS certificates, we need to create an Issuer resource that will perform that task and generate the secrets for the certificates. We can create an <strong>Issuer</strong> or a <strong>ClusterIssuer</strong> resource. They are the same, except that the <strong>ClusterIssuer</strong> is not namespace and thus can be used in any namespace. We will use an <strong>Issuer</strong> resource under our <code class="language-text">simple-app</code> namespace.</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Issuer
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>letsencrypt
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">acme</span><span class="token punctuation">:</span>
    <span class="token key atrule">privateKeySecretRef</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>letsencrypt
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//acme<span class="token punctuation">-</span>v02.api.letsencrypt.org/directory
    <span class="token key atrule">solvers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">http01</span><span class="token punctuation">:</span>
        <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
          <span class="token key atrule">class</span><span class="token punctuation">:</span> contour</code></pre></div>
</div></details>
<blockquote>
<p>This issuer uses the <strong>Let's Encrypt</strong> ACME server, there are ways to provide locally stored certs, check the <a href="https://cert-manager.io/docs/concepts/issuer/">official documentation</a> for more information.</p>
</blockquote>
<h3 id="tls-certificates" style="position:relative;"><a href="#tls-certificates" aria-label="tls certificates permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TLS certificates</h3>
<p>For TLS certificates, we will use the <code class="language-text">cert-manager</code> API. We will create a certificate object which will be issued by an Issuer. The validation process (<strong>HTTP-01 Challenge</strong>) will generate a secret that will be used by <strong>Httpproxy</strong> to redirect the trafic over TLS.</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Certificate
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>certs
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">dnsNames</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> simple<span class="token punctuation">-</span>app.example.com
  <span class="token key atrule">issuerRef</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>letsencrypt
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Issuer
  <span class="token key atrule">secretName</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>certs</code></pre></div>
</div></details>
<blockquote>
<p><strong>NOTE</strong>: You may need to restart Httproxy after validating certificates if you issued the certifiactes after creating the Httpproxy.</p>
</blockquote>
<h3 id="httpproxy" style="position:relative;"><a href="#httpproxy" aria-label="httpproxy permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Httpproxy</h3>
<p>Once project contour is ready, we can create a HTTP proxy service that will be used to redirect all traffic to the project contour service using our previously configured DNS record.</p>
<details>
<summary> <b>Show Manifest</b> </summary><div style="margin-left:20px">
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> projectcontour.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HTTPProxy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>httpproxy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">virtualhost</span><span class="token punctuation">:</span>
    <span class="token key atrule">fqdn</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app.example.com
    <span class="token key atrule">tls</span><span class="token punctuation">:</span>
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app<span class="token punctuation">-</span>certs
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>app
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3300</span>
    <span class="token key atrule">loadBalancerPolicy</span><span class="token punctuation">:</span>
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span> Cookie</code></pre></div>
</div></details>
<blockquote>
<p>Note our simple-app is never running on port '80' as it is typical from web applications. We should avoid deploying our apps to container ports under 1024 since they would run as <strong>privileged</strong> user, causing a potential security issue.</p>
</blockquote>
<h2 id="conclusions" style="position:relative;"><a href="#conclusions" aria-label="conclusions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusions</h2>
<p>As you may have noticed, deploying an application to production is a bit more harder than doing it locally. Certificates and DNS makes the process a little more complicated, but luckily we count with the help of <strong>Project Contour</strong> and <strong>Cert-Manager</strong>. Still, the process is not so straight forward and depends a lot on configuration and knowledge of the underlying technologies, such as DNS records and networking.</p></section><footer class="post__PostFooter-sc-h8gzap-9 cYqZmU"><p>Published under <span><a class="post__FooterTagLink-sc-h8gzap-10 bICWKm" href="/tag/guide">Guide</a>, </span><span><a class="post__FooterTagLink-sc-h8gzap-10 bICWKm" href="/tag/mid-level">Mid-level</a>, </span><span><a class="post__FooterTagLink-sc-h8gzap-10 bICWKm" href="/tag/kubernetes">Kubernetes</a></span> on <time dateTime="2022-11-06T15:25:00.000Z">06 November, 2022</time>.</p><p>Last updated on <time dateTime="2022-11-06T00:00:00.000Z">06 November, 2022</time>.</p></footer></article></div></div><section class="post__PostAddition-sc-h8gzap-11 ghlSja"><div class="common__Container-sc-1d5kp8-0 post__PostAdditionContent-sc-h8gzap-12 jAnmWt"><div class="post__BioWrapper-sc-h8gzap-13 fZmyke"><section class="bio__StyledBio-sc-19adui4-0 iHGPyz"><img alt="alesancor1" style="max-width:55px;border-radius:100%;margin-right:20px;float:left" src="https://avatars.githubusercontent.com/alesancor1"/><h3 class="bio__AuthorName-sc-19adui4-2 lfACiL">alesancor1</h3><p class="bio__AuthorDescription-sc-19adui4-1 lbetsi">Welcome to my blog!</p><ul class="social-channel-list__StyledSocialChannels-sc-16w9pwh-0 YZAaE"><li class="social-channel-list__StyledSocialChannel-sc-16w9pwh-1 hLhzMS"><a href="https://www.linkedin.com/in/alesancor/" target="_blank" rel="noopener" aria-label="linkedin"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="social-channel-list__StyledSocialChannel-sc-16w9pwh-1 hLhzMS"><a href="https://github.com/alesancor1" target="_blank" rel="noopener" aria-label="github"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li></ul></section></div></div></section></main><footer class="style__StyledFooter-sc-1oqvjzu-0 gpDhwt"><div class="common__Container-sc-1d5kp8-0 style__FooterContainer-sc-1oqvjzu-1 ctpkkx"><nav class="style__StyledNav-sc-1oqvjzu-4 etXHUJ"><ul><li><a class="style__FooterMenuLink-sc-1oqvjzu-6 dLTgSL" href="/archive">Posts</a></li><li><a class="style__FooterMenuLink-sc-1oqvjzu-6 dLTgSL" href="/tags">Tags</a></li></ul></nav><div><p class="style__Copyright-sc-1oqvjzu-2 cXOFUh"><strong>Personal Blog</strong> © <!-- -->2022</p><p class="style__DesignBy-sc-1oqvjzu-3 bqPxdl">Theme by <a href="https://nehalist.io" target="_blank" rel="noopener">nehalist.io</a></p></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/simple-app-kubernetes/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-6345fe6c192448f369b8.js"],"app":["/app-2739c70ed76892e353dc.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-pages-404-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-pages-404-tsx-7c60f8995aafae9af341.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-pages-archive-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-pages-archive-tsx-57945304544f85d915e6.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-pages-tags-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-pages-tags-tsx-c1125b91fc9a10a7f6c7.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-page-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-page-tsx-65a2eb7e72da971bdec1.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx-3b2e3e21f50839ebc5db.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-posts-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-posts-tsx-8b289a6c027c8ed7f316.js"],"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-tag-tsx":["/component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-tag-tsx-c2071567154139543e29.js"]};/*]]>*/</script><script src="/polyfill-6345fe6c192448f369b8.js" nomodule=""></script><script src="/component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx-3b2e3e21f50839ebc5db.js" async=""></script><script src="/commons-2b189c38f90eef275b71.js" async=""></script><script src="/1bfc9850-3de49fcd9cce71919e67.js" async=""></script><script src="/styles-7d4153d260c0197f0043.js" async=""></script><script src="/app-2739c70ed76892e353dc.js" async=""></script><script src="/framework-999a01e9e4c894cffffe.js" async=""></script><script src="/webpack-runtime-a6fb0571f21923dc760f.js" async=""></script></body></html>