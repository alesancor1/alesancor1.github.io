{"componentChunkName":"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx","path":"/simple-app-kubernetes/","result":{"data":{"post":{"id":"830c48ca-a743-53ff-b6c6-5d86b4d03588","headings":[{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2}],"frontmatter":{"title":"Deploying a simple NodeJS App in kubernetes","path":"/simple-app-kubernetes/","tags":["Guide","Mid-level","Kubernetes"],"excerpt":"Steps on how to deploy simple NodeJS app, connected to a MongoDB host and exposing its endpoints through a Kubernetes service.","created":"2022-11-06T15:25:00.000Z","createdPretty":"06 November, 2022","updated":"2022-11-06T00:00:00.000Z","updatedPretty":"06 November, 2022","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVQoz2PI3u+OibL2uyXutm48kTT/akfyHtuMfc45+z0wlTGg8YGKMve5tJ3OWH172q5Hq44937np3vyZlxvyDngBTcSl2SP3gGfuAa+8gz5pex17zxaee3Vw+qW6pdf7N96Zt/PhytQ99kApoAKgsmyYKxjAfC8gK32vE1BF6l77hF2Wq29NW3Vr2rmXhx59urP67rSdD1aUHQkBeiRljz1QGVAxRBdDyh47oFDBQb/Gk8nTLtVsuDvvyttT3359/ff33////798+3Tp/OV///7d/3h924MlQPc3nUwpOOgL1mXHsO3+kktvTjz/8vDHn2//weDXr19TJ02fu276gnNTZsycWVRU1Nnd+fzZc5Dcv/8///x4/vXhxddHgWHB8B8J/P33Byj/7fvXG9dvnr12eu2FZSs2Ltu3b//uvbu+/fj27/9fiAK4egYgH4yArkSIQtgvP768+eL6f3QAVPoXoovhPzbwFwj+/f3z9/fvP7+BHgbysCoDAEnUiX1fWTlwAAAAAElFTkSuQmCC","aspectRatio":2.127659574468085,"src":"/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png","srcSet":"/static/6377120ee106e93bf8074fa36b79a901/dc47e/cover.png 200w,\n/static/6377120ee106e93bf8074fa36b79a901/9f2d5/cover.png 400w,\n/static/6377120ee106e93bf8074fa36b79a901/90823/cover.png 800w,\n/static/6377120ee106e93bf8074fa36b79a901/77647/cover.png 1200w,\n/static/6377120ee106e93bf8074fa36b79a901/f8d4f/cover.png 1600w,\n/static/6377120ee106e93bf8074fa36b79a901/09911/cover.png 2800w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<style>\n    summary {\n        cursor: pointer;\n    }\n</style>\n<blockquote>\n<p><strong>NOTE</strong>: This guide will assume you have a basic understanding of Kubernetes and know how to run and manage a cluster. If you haven't already read my post about <a href=\"/kubernetes-fundamentals\">Kubernetes fundamentals</a>, I encourage you to read it first.</p>\n<p>All the code in this guide is available on <a href=\"https://github.com/alesancor1/Blog-Projects/tree/main/guides/simple-app-kubernetes\">GitHub</a></p>\n</blockquote>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>For this guide, we will be deploying the simple NodeJS we build in a previous post, feel free to go <a href=\"/create-simple-app\">check it out</a> first. We will go through all the steps to set up our simple NodeJS app inside a Kubernetes cluster.</p>\n<blockquote>\n<p>This guide is parallel to the <a href=\"/simple-app-helm\">Creating a Helm Chart for a simple NodeJS App</a> guide, so you can open both posts and compare them, since both posts will follow the same exact structure.</p>\n</blockquote>\n<h2 id=\"creating-the-database-manifests\" style=\"position:relative;\"><a href=\"#creating-the-database-manifests\" aria-label=\"creating the database manifests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the Database manifests</h2>\n<p>We will first write the database manifests files, starting by the service and then the pvc and finally the deployment. This order will be the same for the creation of the resources, since deployment depends on the pvc and the service needs to exist in order for the pods to be exposed by it.</p>\n<h3 id=\"service\" style=\"position:relative;\"><a href=\"#service\" aria-label=\"service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Service</h3>\n<p>Since we are deploying a MongoDB, we will set the service to use the default MongoDB port: <code class=\"language-text\">27017</code>. This way, our manifest will have the same port and target port:</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># svc.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'27017'</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db</code></pre></div>\n</div></details>\n<blockquote>\n<p>This service will not be exposed to the outside world, all database connections will be managed internally through the <strong>kubernetes built-in DNS</strong>.</p>\n</blockquote>\n<h3 id=\"persistent-volume-claim\" style=\"position:relative;\"><a href=\"#persistent-volume-claim\" aria-label=\"persistent volume claim permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Persistent Volume Claim</h3>\n<p>For persistence, we will declare a <strong>PVC</strong> that claims a volume with 20Gi storage and <em>ReadWriteOnce</em> access mode:</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># pvc.yaml</span>\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 20Gi</code></pre></div>\n</div></details>\n<blockquote>\n<p>We will not create a persistent volume that matches this PVC, as mentioned in the <strong>Kubernetes Fundamentals</strong> post, we are letting de cluster <strong>dynamically provision</strong> the volume for us.</p>\n</blockquote>\n<h3 id=\"deployment\" style=\"position:relative;\"><a href=\"#deployment\" aria-label=\"deployment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deployment</h3>\n<p>Once the service and PVC are created, we will now write the deployment manifest. The deployment will have the label <code class=\"language-text\">app</code> to be matched by the service <strong>selector</strong>, and will mount a volume to the <code class=\"language-text\">/data/db</code> container directory. This volume will reference our <strong>PVC</strong>:</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># deployment.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> Always\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span>\n              <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /data/db\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volume<span class=\"token punctuation\">-</span>simple<span class=\"token punctuation\">-</span>db<span class=\"token punctuation\">-</span>data\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volume<span class=\"token punctuation\">-</span>simple<span class=\"token punctuation\">-</span>db<span class=\"token punctuation\">-</span>data\n          <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db</code></pre></div>\n</div></details>\n<h2 id=\"creating-the-app-manifests\" style=\"position:relative;\"><a href=\"#creating-the-app-manifests\" aria-label=\"creating the app manifests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the App manifests</h2>\n<h3 id=\"service-1\" style=\"position:relative;\"><a href=\"#service-1\" aria-label=\"service 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Service</h3>\n<p>The deployment will be made for both <strong>local</strong> and <strong>production</strong> environments, so we will need to write a service that binds the ports of the cluster to our <strong>local machine</strong> ports.</p>\n<p>Starting with the local service, we define it as a NodePort, which port and nodePort will be the same in which the app is running inside the container: <code class=\"language-text\">3300</code>.</p>\n<blockquote>\n<p><strong>NOTE</strong>: Since the port <code class=\"language-text\">3300</code> is not inside the default <strong>NodePort range</strong>, we will need to add the <code class=\"language-text\">--node-port-range</code> flag to the kubeapi-server.yml file. As described in the <strong>Kubernetes Fundamentals</strong> post.</p>\n</blockquote>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># svc-local.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app</code></pre></div>\n</div></details>\n<p>On the other hand, the production service will be set as <strong>ClusterIP</strong> (default) and exposed internally at port <code class=\"language-text\">3300</code> too:</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># svc.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app</code></pre></div>\n</div></details>\n<blockquote>\n<p>The service port can actually be any, we will be using the same port for both environments.</p>\n</blockquote>\n<h3 id=\"deployment-1\" style=\"position:relative;\"><a href=\"#deployment-1\" aria-label=\"deployment 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deployment</h3>\n<p>Our app will run on the port <code class=\"language-text\">3300</code> of the container. For that, we need to specify that port under the <code class=\"language-text\">containerPort</code> field, apart from passing the <code class=\"language-text\">PORT</code> environment variable to the container. We also have to make sure the labels specified in metadata are the same as the service selector.</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># deployment.yaml</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PORT\n            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3300\"</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DB_HOST\n            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DB_PORT\n            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"27017\"</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DB_NAME\n            <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alesancor1/simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">:</span>latest\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> Always\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n              <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 300Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 500Mi</code></pre></div>\n</div></details>\n<blockquote>\n<p>Note that the <code class=\"language-text\">DB_HOST</code> env variable is set the same as the name of the MongoDB service. This is because the cluster automatically provides service discovery through its <strong>internal DNS</strong>.</p>\n</blockquote>\n<h2 id=\"running-locally-on-a-single-node-cluster\" style=\"position:relative;\"><a href=\"#running-locally-on-a-single-node-cluster\" aria-label=\"running locally on a single node cluster permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running locally on a single node cluster</h2>\n<p>With all the manifests files created, we can now deploy the app to the cluster. We will start a single node cluster (<strong>Minikube</strong> or <strong>Docker k8s</strong>) and apply the manifests in the same order as this guide does. For that, use the <code class=\"language-text\">-f</code> flag to specify the manifests files to be applied. Don't forget to create the namespace before applying the manifests.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl create namespace simple-app\n$ kubectl apply -f &lt;file></code></pre></div>\n<p>If you performed all the steps correctly (remember to run only local services manifests), you should be able to see the app running on <a href=\"http://localhost:3300\">http://localhost:3300</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d1f7d5ac4acebcb58c6854f4307e19ce/78363/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAc0lEQVQI1z2Kyw6CMBBF+VQlulAatOKGRXEhn6ppk05naPmAS7UNi5Oc+2ge0wxtZvTjC6fbE4frHcdOV7IrvedW1W73ks/9ADVOuJg3Gvv5QkQQF4GzFs5ZBKI/nPltzAwJITvX7wLyHkQeKca8l25NCRuLMHk2k5JCvgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result\"\n        title=\"result\"\n        src=\"/static/d1f7d5ac4acebcb58c6854f4307e19ce/c1b63/result.png\"\n        srcset=\"/static/d1f7d5ac4acebcb58c6854f4307e19ce/5a46d/result.png 300w,\n/static/d1f7d5ac4acebcb58c6854f4307e19ce/0a47e/result.png 600w,\n/static/d1f7d5ac4acebcb58c6854f4307e19ce/c1b63/result.png 1200w,\n/static/d1f7d5ac4acebcb58c6854f4307e19ce/78363/result.png 1522w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"production-environments-dns-and-tls-configuration\" style=\"position:relative;\"><a href=\"#production-environments-dns-and-tls-configuration\" aria-label=\"production environments dns and tls configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Production environments: DNS and TLS configuration</h2>\n<p>For production environments, we will configure a DNS record pointing to the service. We will also configure a TLS certificate and a certificate signing request. For doing that, we will use <strong>Project Contour</strong> and <strong>Cert-Manager</strong> APIs, which simplifies the process. Since they are not native, first thing we need to do is installing them by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$    kubectl apply -f https://projectcontour.io/quickstart/contour.yaml\n$    kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.1.0/cert-manager.yaml</code></pre></div>\n<blockquote>\n<p><strong>Project Contour</strong> provide a Load Balancer service that will be our reverse proxy. Be sure to obtain its <strong>external IP</strong> and configure an <strong>A record</strong> in your <strong>NS zone</strong> pointing to that IP. The External IP can be obtained running <code class=\"language-text\">kubectl get -n projectcontour service envoy</code> (it takes a while to be ready).</p>\n<p>Be sure to apply the local services manifests when deploying to production</p>\n</blockquote>\n<h3 id=\"issuer-and-clusterissuer\" style=\"position:relative;\"><a href=\"#issuer-and-clusterissuer\" aria-label=\"issuer and clusterissuer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Issuer and ClusterIssuer</h3>\n<p>Before validating TLS certificates, we need to create an Issuer resource that will perform that task and generate the secrets for the certificates. We can create an <strong>Issuer</strong> or a <strong>ClusterIssuer</strong> resource. They are the same, except that the <strong>ClusterIssuer</strong> is not namespace and thus can be used in any namespace. We will use an <strong>Issuer</strong> resource under our <code class=\"language-text\">simple-app</code> namespace.</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> cert<span class=\"token punctuation\">-</span>manager.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Issuer\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>letsencrypt\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">acme</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">privateKeySecretRef</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>letsencrypt\n    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//acme<span class=\"token punctuation\">-</span>v02.api.letsencrypt.org/directory\n    <span class=\"token key atrule\">solvers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http01</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ingress</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">class</span><span class=\"token punctuation\">:</span> contour</code></pre></div>\n</div></details>\n<blockquote>\n<p>This issuer uses the <strong>Let's Encrypt</strong> ACME server, there are ways to provide locally stored certs, check the <a href=\"https://cert-manager.io/docs/concepts/issuer/\">official documentation</a> for more information.</p>\n</blockquote>\n<h3 id=\"tls-certificates\" style=\"position:relative;\"><a href=\"#tls-certificates\" aria-label=\"tls certificates permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TLS certificates</h3>\n<p>For TLS certificates, we will use the <code class=\"language-text\">cert-manager</code> API. We will create a certificate object which will be issued by an Issuer. The validation process (<strong>HTTP-01 Challenge</strong>) will generate a secret that will be used by <strong>Httpproxy</strong> to redirect the trafic over TLS.</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> cert<span class=\"token punctuation\">-</span>manager.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Certificate\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>certs\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">dnsNames</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> simple<span class=\"token punctuation\">-</span>app.example.com\n  <span class=\"token key atrule\">issuerRef</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>letsencrypt\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Issuer\n  <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>certs</code></pre></div>\n</div></details>\n<blockquote>\n<p><strong>NOTE</strong>: You may need to restart Httproxy after validating certificates if you issued the certifiactes after creating the Httpproxy.</p>\n</blockquote>\n<h3 id=\"httpproxy\" style=\"position:relative;\"><a href=\"#httpproxy\" aria-label=\"httpproxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Httpproxy</h3>\n<p>Once project contour is ready, we can create a HTTP proxy service that will be used to redirect all traffic to the project contour service using our previously configured DNS record.</p>\n<details>\n<summary> <b>Show Manifest</b> </summary><div style=\"margin-left:20px\">\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> projectcontour.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HTTPProxy\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>httpproxy\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">virtualhost</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">fqdn</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app.example.com\n    <span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>certs\n  <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3300</span>\n    <span class=\"token key atrule\">loadBalancerPolicy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span> Cookie</code></pre></div>\n</div></details>\n<blockquote>\n<p>Note our simple-app is never running on port '80' as it is typical from web applications. We should avoid deploying our apps to container ports under 1024 since they would run as <strong>privileged</strong> user, causing a potential security issue.</p>\n</blockquote>\n<h2 id=\"conclusions\" style=\"position:relative;\"><a href=\"#conclusions\" aria-label=\"conclusions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusions</h2>\n<p>As you may have noticed, deploying an application to production is a bit more harder than doing it locally. Certificates and DNS makes the process a little more complicated, but luckily we count with the help of <strong>Project Contour</strong> and <strong>Cert-Manager</strong>. Still, the process is not so straight forward and depends a lot on configuration and knowledge of the underlying technologies, such as DNS records and networking.</p>"},"primaryTag":{"name":"Guide","color":"#007acc"}},"pageContext":{"postId":"830c48ca-a743-53ff-b6c6-5d86b4d03588","primaryTag":"Guide"}},"staticQueryHashes":["1116962356","2275848304","545095672","625280739"]}