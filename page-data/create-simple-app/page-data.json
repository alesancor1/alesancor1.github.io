{"componentChunkName":"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-post-tsx","path":"/create-simple-app/","result":{"data":{"post":{"id":"75048d90-d183-5c61-8357-3322c0d8d1dd","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"Creating a simple App with NodeJS, ExpressJS and MongoDB","path":"/create-simple-app/","tags":["Guide","Beginner","NodeJS","Docker"],"excerpt":"Steps on how to create a simple NodeJS app, connect it to a MongoDB host, expose its data through ExpressJS server and build a Docker image from it.","created":"2022-02-11T00:00:00.000Z","createdPretty":"11 February, 2022","updated":"2022-02-11T00:00:00.000Z","updatedPretty":"11 February, 2022","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQoz61STU+DQBTkr3vxhP4DY4xn7x70bNI2baQ1EsCDci1ZsGU/2H07dkEIpUo07SQTXnZ484Z9eDgxvOGBtbbmTxjT9gzbFx2JqGbb2JnYpiZLrT2GvY7e2MS+Nqz7PEgopcQ6W0ORQhiGiKIIWuuu2SV2yHiGx+ThYLDkW0hRNgndwSpY4fbuBuf3Z/AvfPiXPuIkBucCjOVgeYFyK5CyD1xPrxAGz4hfX7CYPGE5n+I9DpAmy91g0xi6NJYs5ukEi7cZyg2HqlSdzGnGPY3pPk8KgUopfOYMm6IA7TT61vfu0JCGttXoFi3+seUWbpPDi/8rvb7Zb/VRP/ax+ALHTFzuPSVcigAAAABJRU5ErkJggg==","aspectRatio":1.7699115044247788,"src":"/static/ab98d8eeab250a166555ae868b07a029/90823/cover.png","srcSet":"/static/ab98d8eeab250a166555ae868b07a029/dc47e/cover.png 200w,\n/static/ab98d8eeab250a166555ae868b07a029/9f2d5/cover.png 400w,\n/static/ab98d8eeab250a166555ae868b07a029/90823/cover.png 800w,\n/static/ab98d8eeab250a166555ae868b07a029/77647/cover.png 1200w,\n/static/ab98d8eeab250a166555ae868b07a029/f8d4f/cover.png 1600w,\n/static/ab98d8eeab250a166555ae868b07a029/4ce6a/cover.png 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<blockquote>\n<p>This guide assumes you already know javascript.\nYou can find all the code used throughout this guide <a href=\"https://github.com/alesancor1/Blog-Projects/tree/main/guides/simple-app\">here</a></p>\n</blockquote>\n<h2 id=\"requirements\" style=\"position:relative;\"><a href=\"#requirements\" aria-label=\"requirements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Requirements</h2>\n<p>In order to perform a full deployment of a simple Node App, we need to first meet the following requirements:</p>\n<ol>\n<li>Install <a href=\"https://nodejs.org/es/download/\">NodeJS and npm</a>.</li>\n<li>Install <a href=\"https://docs.docker.com/engine/install/\">Docker</a> and <a href=\"https://docs.docker.com/compose/install/\">Docker Compose</a>.</li>\n<li>Any SCE or IDE (We will be using VSCode for this guide)</li>\n<li>Git (Not actually needed, but always recommended)</li>\n</ol>\n<blockquote>\n<p>Windows users may be interested in installing <a href=\"https://www.docker.com/get-started\">Docker Desktop</a> since Compose comes already integrated along a single node Kubernetes Cluster</p>\n</blockquote>\n<h2 id=\"first-steps\" style=\"position:relative;\"><a href=\"#first-steps\" aria-label=\"first steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>First steps</h2>\n<p>Every NodeJS always app starts with a <strong>package.json</strong> file. This file provides basic information and metadata about the project, it is also where dependencies and scripts are defined. The entrypoint to our npm package is defined in the <em>main</em> field of package.json, this way, runing <code class=\"language-text\">npm start</code> will start the app asi if we ran <code class=\"language-text\">node index</code></p>\n<blockquote>\n<p>Many npm packages, such as <em>prettier</em>, <em>snyk</em>, <em>mocha</em> or <em>nyc</em> use the package.json file as a mean to override default configuration. This transform package.json into an important configuration file for many dependencies.</p>\n</blockquote>\n<p>In order to create our first node app, we can simply run <code class=\"language-text\">npm init</code>. This command will prompt some fields that we need to fill for our package.json to generate. When generated, a file named <strong>package-lock.json</strong> will be created, too. Lock files contains the full dependency tree of all packages. Many developers tend to avoid uploading this file to SVNs, it is actually a really good practice to do so, since we ensure everyone cloning or forking our repository will be using the same dependencies.</p>\n<p>We have now generated the basic files in order to start a new NodeJS app or npm package. Now it is time to install some dependencies before start coding.</p>\n<h2 id=\"installing-dependencies\" style=\"position:relative;\"><a href=\"#installing-dependencies\" aria-label=\"installing dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing dependencies</h2>\n<p>Node comes along with npm, a really powerful package manager that allow developers to download and install libraries that serve as dependencies for other developers' projects. The purpose of this guide is to create a NodeJS application that is able to connect to MongoDB and allow making REST requests to an ExpressJS server. </p>\n<p>Neither of that is natively supported in Node, so here is where npm comes. We will install <a href=\"https://www.npmjs.com/package/express\">ExpressJS</a> and <a href=\"https://www.npmjs.com/package/mongoose\">mongoose</a> through npm for our app to be able to receive clients requests and connect to MongoDB. To install them, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install express mongoose</code></pre></div>\n<blockquote>\n<p>You may also find this command along <strong>--save</strong> and <strong>--save-dev</strong> options. --save option is no longer required since by default npm will write the dependencies to the <em>dependencies</em> field of package.json, meaning this packages are <strong>core dependencies</strong> and must be installed for your code to work. On the other hand, --save-dev option tells npm to write the packages to <em>dev_dependencies</em>, meaning that those package are only used for development and therefore not required in production environments.</p>\n<p>Some packages typically installed under <em>dev_dependencies</em> are: Mocha, Nyc, Prettier, EsLint, Snyk... </p>\n</blockquote>\n<p>Once npm has installed the dependencies, we can start coding by creating a new file named <strong>index.js</strong>. This file will be the entrypoint of our app, and will be the first file that will be executed when the app is started.</p>\n<h2 id=\"coding-the-app\" style=\"position:relative;\"><a href=\"#coding-the-app\" aria-label=\"coding the app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coding the app</h2>\n<h3 id=\"requiring-dependencies\" style=\"position:relative;\"><a href=\"#requiring-dependencies\" aria-label=\"requiring dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Requiring Dependencies</h3>\n<p>First thing we need to do before start writing code, is to require those dependencies we will need for our purpose. As we said before, this app is meant to connect to mongoDB and expose its data through an ExpressJS server, so we will need to import the ExpressJS and Mongoose libraries. There are two popular ways of importing dependencies depending on the specification our package follows. </p>\n<p>The standard way of importing dependencies has always been to use the <code class=\"language-text\">require</code> function. This standard is known as <strong>CommonJS</strong> and is the most widely used by NodeJS developers. However, since the release of Node 12 (LTS), <strong>ECMA Script</strong>, also known as <strong>ES Modules (ESM)</strong> has been gaining wide support and popularity. ES Modules use the <code class=\"language-text\">import</code> syntax, which allows to load modules synchronously and asynchronously with a more readable syntax.</p>\n<blockquote>\n<p>Since CommonJS is the most popular for now, we will be using this specification for our simple project. A future post will describe in depth the pros and cons of both specifications when it comes to NodeJS development.</p>\n</blockquote>\n<p>That being said, we can now import our packages using the <strong>require</strong> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Index.js</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"environment-variables\" style=\"position:relative;\"><a href=\"#environment-variables\" aria-label=\"environment variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Environment Variables</h3>\n<p>In order to connect to MongoDB, it is a good practice to define environment variables. This way, we can change the host and port of MongoDB without having to change the code. </p>\n<blockquote>\n<p><strong>tip:</strong> Hard-coding some values in the code may lead to critical security issues, hard maintenance and potential bugs. Always try to make your code as easy to maintain as possible. Sensitive data like passwords or tokens <strong>MUST NEVER</strong> be present in the code.</p>\n</blockquote>\n<p>We will be declaring environment variables for the configuration needed to connect to the database, apart from the port in which our app will be running:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Index.js</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">32000</span>\n<span class=\"token keyword\">const</span> mongoHost <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_HOST</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> mongoPort <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_PORT</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"27017\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> mongoDBName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_NAME</span> <span class=\"token operator\">||</span> <span class=\"token string\">'simple-db'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Note that we are using the <strong>OR operator</strong> ' || ' to define default values for the environment variables, this will allow us to run the app locally without having to specify the values for the environment variables.</p>\n<h3 id=\"writting-a-mongoose-model\" style=\"position:relative;\"><a href=\"#writting-a-mongoose-model\" aria-label=\"writting a mongoose model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Writting a mongoose model</h3>\n<p>For storing data in our database, we first need to provide a <strong>Schema</strong> that defines how this data is actually structured. This Schema will be used to create a Mongoose model. We are going to create a 'Log' model, consisting on the <strong>timestamp</strong> and the <strong>user-agent</strong> of the client request.</p>\n<p>Create a new file named <strong>Log.js</strong> under a directory named <strong>models</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Log.js</span>\n<span class=\"token keyword\">const</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Schema <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span>Schema<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> LogSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Schema</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">timestamp</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Date<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">useragent</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Log'</span><span class=\"token punctuation\">,</span> LogSchema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Don't forget to export the model so that we can use it in other files.</p>\n<h3 id=\"creating-and-configuring-express-server\" style=\"position:relative;\"><a href=\"#creating-and-configuring-express-server\" aria-label=\"creating and configuring express server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating and configuring Express server</h3>\n<p>Creating a express server is as simple as creating a new instance of the ExpressJS class. We will declare a new constant named <strong>app</strong> and assign it to the new ExpressJS instance:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Index.js</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>With the ExpressJS instance created, we can now start configuring our app. First thing we will do is configure an endpoint that receives GET requests to the root of our app. This endpoint will store the timestamp and the user-agent of the client request in the database and will return all the stored logs right after.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> newLog <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">timestamp</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">useragent</span><span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">'Unknown'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    newLog<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        Log<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">logs</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>logs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Unknown error'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>Express and mongoose functions are asyncronous and therefore return <strong>promises</strong>. We can use the <strong>then</strong> function to handle the success case and the <strong>catch</strong> function to handle the error case. You will find more about promises in future posts.</p>\n</blockquote>\n<h3 id=\"connecting-to-mongo-and-starting-the-server\" style=\"position:relative;\"><a href=\"#connecting-to-mongo-and-starting-the-server\" aria-label=\"connecting to mongo and starting the server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connecting to Mongo and starting the server</h3>\n<p>Once created our database model and configured the endpoints for the express server, it is time to connect and start listening to a port. Since this app fully relies on MongoDB to work, we will code this in a way to force mongoose to connect before starting the server. We can easily do that thanks to <strong>then</strong> function of promises.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mongoURL <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mongodb://</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mongoHost<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mongoPort<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mongoDBName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\nmongoose<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>mongoURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span> <span class=\"token parameter\">resp</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Connected! Simple app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Could not connect to db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Don't forget to handle possible connection errors or Node process will prompt a hardly readable message.</p>\n<h2 id=\"running-the-app-locally\" style=\"position:relative;\"><a href=\"#running-the-app-locally\" aria-label=\"running the app locally permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running the app locally</h2>\n<p>Thanks to default values declared for the environment variables, we just need to set up a MongoDB instance and run <code class=\"language-text\">npm start</code> to start the app. You can easily deploy a mongo container with docker:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run --name mongo -p 27017:27017 -d mongo:latest </code></pre></div>\n<p>If you performed all the steps correctly, you should be able to access the app at <a href=\"http://localhost:32000/\">http://localhost:32000/</a> in your browser. You will see a log each time you reload the page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ef6720f251a6380ebc9eb3754a8cb39/9f9a4/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAlElEQVQI142KQQrCMBREe66CiAiKYLEoKIgr3XlUNU3yk1ZQakn7k7Sp+7r0ewOHxyzeTLQ+npPDaZru4tkynif/MFqsJul2vNlHlxu7Ms5BZUJmErgEqbQgQIPOVV4wLmhSuvh5UHQQAPfH0zgfVWX5qirrLNa1pSB655z31J1vQwi1Mdg0oe1a8tYhIr3eff8Zhi8fNng8Ue+szQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result\"\n        title=\"result\"\n        src=\"/static/9ef6720f251a6380ebc9eb3754a8cb39/c1b63/result.png\"\n        srcset=\"/static/9ef6720f251a6380ebc9eb3754a8cb39/5a46d/result.png 300w,\n/static/9ef6720f251a6380ebc9eb3754a8cb39/0a47e/result.png 600w,\n/static/9ef6720f251a6380ebc9eb3754a8cb39/c1b63/result.png 1200w,\n/static/9ef6720f251a6380ebc9eb3754a8cb39/9f9a4/result.png 1560w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"dockerizing-and-pushing-the-image\" style=\"position:relative;\"><a href=\"#dockerizing-and-pushing-the-image\" aria-label=\"dockerizing and pushing the image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerizing and pushing the image</h2>\n<p>It is a common practice to dockerize the app into an image and push it to a registry before moving to a production environment. Running a docker container in production avoids the need to install the required infrastructure and configuration (NodeJS, npm, mongoDB, etc.) in the remote machine and allows the app to scale dinamically if configured correctly.</p>\n<blockquote>\n<p>Applications based on the microservices architecture are usually deployed in clusters (e.g kubernetes) which relies on Docker containers.</p>\n</blockquote>\n<p>The first step is to create a <strong>Dockerfile</strong> in the root of the project. This Dockerfile will be used to build the image, commonly from another image (NodeJS official image for this example). We indicate the steps needed to run our app following the <a href=\"https://docs.docker.com/engine/reference/builder/\">Dockerfile reference</a>, the result is shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Dockerfile</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:16.13.0-alpine3.14</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install --only=prod</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> NODE_ENV=production</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NODE_ENV <span class=\"token variable\">$NODE_ENV</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [ <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"index.js\"</span> ]</span></code></pre></div>\n<p>Once the Dockerfile is ready, we can build our image by running the <strong>docker build</strong> command. We will use the <strong>-t</strong> flag to specify the name of the image we want to build.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker build -t alesancor1/simple-app .</code></pre></div>\n<blockquote>\n<p>If you are planning to upload the image to <strong>DockerHub</strong>, you need to specify the tag following the username/app-name format.</p>\n</blockquote>\n<p>Now the image is created and stored in our local machine, for pushing it to DockerHub, we will need to login to DockerHub. To do this, we will use the <strong>docker login</strong> command.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker login -u &lt;username> --password-stdin</code></pre></div>\n<blockquote>\n<p>It is reccommended to use --password-stdin options to avoid typing the password in the command line without any tipe of encryption.</p>\n</blockquote>\n<p>Finally, we can push our docker image to docker hub and indicate a version tag for our app. In this case, I specify the 'latest' version tag.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker push alesancor1/simple-app:latest</code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>This is the end of the guide. If you want to learn more about deploying applications in production environment, check out the <a href=\"http://alesancor1.github.io/kubernetes-fundamentals\">Kubernetes post</a> and <a href=\"http://alesancor1.github.io/helm-fundamentals\">Helm post</a> to learn more about the different tools and techniques used to deploy applications in production.</p>"},"primaryTag":{"name":"Guide","color":"#007acc"}},"pageContext":{"postId":"75048d90-d183-5c61-8357-3322c0d8d1dd","primaryTag":"Guide"}},"staticQueryHashes":["2275848304","545095672","625280739"]}