{"componentChunkName":"component---node-modules-nehalist-gatsby-theme-nehalem-src-templates-posts-tsx","path":"/","result":{"pageContext":{"posts":[{"id":"0c4244e2-659c-5c66-aae6-4b1c381ca67a","headings":[{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3}],"frontmatter":{"title":"Kubernetes fundamentals","path":"/kubernetes-fundamentals","tags":["Technologies","Mid-level","Kubernetes"],"excerpt":"A really brief introduction on the basics of Kubernetes: CLI commands, commonly used resources and basic cluster administration.","created":"2022-02-12T00:00:00.000Z","createdPretty":"12 February, 2022","updated":"2022-02-12T00:00:00.000Z","updatedPretty":"12 February, 2022","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVQoz2P4jw38+wci//79/+7L37//ECJogAGXzquPf+bOf+XU9LRw0eubz39h1Y+uGWLPtSc/7RqeRE9+MWPPx8hJL+wbn9x58Qsui1PzH7D8rD0fvTqeHbj2bfuFr/uvfnNre7r40Ce4LAHNBQtfp856uePC10PXv207/zVx+svyZW8Ia4bIAm3TLX3Yt/X9okOfuja91yt9dPzWd8LOBoYKMJCBYM6+j+Y1jy1rH1vUPF5y5BMk8IkIbaj7/z949fvey18PXv/+8xdrhGJofvXxD9Dy15/+/PiNcOLn73+//vwHdPM/XM6GSKw68Xnyjg9Af87e97F/2/t1p770bn3fv+0D0BfAIDh84xuyz9Ft/vLj3/P3f4D2v/kMIr/9+gckX3/6+/bznxcffn/4iuIBAMvUZiUF5NtBAAAAAElFTkSuQmCC","aspectRatio":1.8656716417910448,"src":"/static/582b2a32df399cc3f40ef62fd099e438/0853f/cover.png","srcSet":"/static/582b2a32df399cc3f40ef62fd099e438/14156/cover.png 125w,\n/static/582b2a32df399cc3f40ef62fd099e438/d6e47/cover.png 250w,\n/static/582b2a32df399cc3f40ef62fd099e438/0853f/cover.png 500w,\n/static/582b2a32df399cc3f40ef62fd099e438/1fa1e/cover.png 730w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<style>\n    table {\n        border-collapse: collapse;\n        width: 100%;\n    }\n    td, th {\n        border: 1px solid #dddddd;\n        padding: 8px;\n    }\n    th {\n        text-align: center;\n        background-color: #dddddd;\n    }\n    tr:nth-child(even) {\n        background-color: #ffffff;\n    }\n    tr:nth-child(odd) {\n        background-color: #efefef;\n    }\n    summary {\n        cursor: pointer;\n    }\n</style>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Kubernetes (commonly abbreviated as k8s) is a <strong>container orchestration</strong> system that is designed to be easy to use and easy to deploy. As the \"container orchestation\" term suggests, Kubernetes relies on containers and offers an administration environment that focus on them. According to their docs:</p>\n<blockquote>\n<p>Kubernetes is a portable and extensible open source platform for managing workloads and services. Kubernetes facilitates automation and declarative configuration. It has a large and rapidly growing ecosystem. Support, tools and services for Kubernetes are widely available.</p>\n</blockquote>\n<p>Summing up, kubernetes offers a fully equiped administration environment for running multiple containers, which makes it the favourite choice when it comes to deploying microservices inside a <strong>cluster</strong>.</p>\n<h3 id=\"clusters\" style=\"position:relative;\"><a href=\"#clusters\" aria-label=\"clusters permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Clusters</h3>\n<p>A Cluster is a set of <strong>nodes</strong> that run containerized applications. Kubernetes clusters allow containers to run across multiple machines and environments: virtual, physical, cloud-based, and on-premises. Kubernetes containers are not restricted to a specific operating system, unlike virtual machines. Instead, they are able to share operating systems and run anywhere.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 479px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/924c59ad7cfb1c94e8f4802c3a76ef0b/a9b70/cluster.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQ0lEQVQ4y42U247TMBRF+/9fAO88wDcgJBBCAiR4qYaZ3pKmTaaTtLnZdeJbstkNdBpmisDtkV3FXdnnnG1PwNH3/WOch+k6uO7y+3EPP8N3tHc8Js9AvsO+ddgqg6Q1qLyDxxXw6H/j9QS/N2vXY68c1oVFmDuE0mAlNWalRtholJ2D+4uq8csmp4VoOmxOoL1FUGgsaoVt4ZBKqvM9YkKnlcCylRBawzmHXXbAfbq/phBIa4+IwIe8w5cqx8uHOb7dKcxixaceDVOf5hJzLZHpBs46FHxBuL1HFO+wZpzhE8/CJyVrVtoh3SC1eP1B4t1U49Unia/LFgmVBlS27jSy3l5Nt2MTB2Bre2zzE9AhFhbLg8H7oMGLVYTvDxKfYyqTR6zaIxaMtVEwTFk1LUqqzMsa2phLDYf6HQgjcFNZpI3DXBi8Sba4TRVuyyObQpg6ASUWTFs57styzIKIwArO+wtwz/qdgIPC2mIaM9WPgrPDj5wdVi3ClsHahbbB0imInjUsKqyiBILqKyEfoReFlcMqs9AswSIxeHsjEDGtX8BmAAaGs2vQdh5tSyvVAlUth7Sd85cu50c/2CYg8Nz+THj60GDL+kSncFTrNY69/7cPT4tUUOHBDv7bUe2yNNg0BFFJZDQCq1HQ3NdOyx8+PC8cDXxPaMQIGTGP36blC+i50Bqkzj4z8bXzPBk/aGyH6CAR5axfIeg/xZNTI1ENBpeNLoX/uhw8OzVbrXEzDzhH2NH907slsn1+gTy5TJ6Onx4Dho/gkBDxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cluster\"\n        title=\"cluster\"\n        src=\"/static/924c59ad7cfb1c94e8f4802c3a76ef0b/a9b70/cluster.png\"\n        srcset=\"/static/924c59ad7cfb1c94e8f4802c3a76ef0b/5a46d/cluster.png 300w,\n/static/924c59ad7cfb1c94e8f4802c3a76ef0b/a9b70/cluster.png 479w\"\n        sizes=\"(max-width: 479px) 100vw, 479px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Clusters consists on a <strong>master node</strong> and a number of <strong>worker nodes</strong>. Nodes are independent machines with a number of cores and memory each which can run multiple containers. The master node controls the state of the cluster and is the origin of all task assignments, coordinating processses such as scheduling and scaling applications, maintaining the cluster state or implementeing updates.</p>\n<p>Worker nodes, on the other hand, are the nodes that perform the master's assignments. They operate as part of one system, orchestated by the master. Worker noeds can be virtual or physical machines.</p>\n<h3 id=\"single-node-clusters\" style=\"position:relative;\"><a href=\"#single-node-clusters\" aria-label=\"single node clusters permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Single Node Clusters</h3>\n<p>Single node clusters are a popular solution for testing and development purposes. Since they consists on a single node, they are able to run in local machines where developers can work on their applications' development.</p>\n<p>Most used single node clusters are <a href=\"https://minikube.sigs.k8s.io/docs/start/\">Minikube</a> and <a href=\"https://docs.docker.com/desktop/kubernetes/\">Docker Kubernetes</a>. The last one comes installed with Docker Desktop so you only need to activate kubernetes from the settings.</p>\n<h3 id=\"kubernetes-cluster-structure\" style=\"position:relative;\"><a href=\"#kubernetes-cluster-structure\" aria-label=\"kubernetes cluster structure permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes Cluster Structure</h3>\n<p>A Kubernetes cluster contains six main components:</p>\n<ol>\n<li><strong>API server:</strong> Exposes a REST interface to all Kubernetes resources. Serves as the front end of the Kubernetes control plane.</li>\n<li><strong>Scheduler:</strong> Places containers according to resource requirements and metrics. Makes note of Pods with no assigned node, and selects nodes for them to run on.</li>\n<li><strong>Controller manager:</strong> Runs controller processes and reconciles the clusterâ€™s actual state with its desired specifications. Manages controllers such as node controllers, endpoints controllers and replication controllers.</li>\n<li><strong>Kubelet:</strong> Ensures that containers are running in a Pod by interacting with the Docker engine , the default program for creating and managing containers. Takes a set of provided PodSpecs and ensures that their corresponding containers are fully operational.</li>\n<li><strong>Kube-proxy:</strong> Manages network connectivity and maintains network rules across nodes. Implements the Kubernetes Service concept across every node in a given cluster.</li>\n<li><strong>Etcd:</strong> Stores all cluster data. Consistent and highly available Kubernetes backing store. </li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1cff3242811833ad24a683ff19209921/3c492/cluster-components.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVQoz4WSbY+aQBDH+f4fpknTNNe0sQ+ePSuKioA8uAIq4Mozu7C7qHgduNyLvuo/EzI77G9mMrOS4JyQKn4XvuA8zzlj9/v99X+S8qI0kbtQdc1ybOQuta1q2IcgbNsW+NtgIDgSSsF5PF7frIdxnLxo1mi21PdHdAwma+O7vFIdt2GNAOJ67a29pmkWBGFZlv9UppSmWRZG58vQNjhxksClrusAq2hN6obWDTQIZYqyInUNwYpQyCjVIEojHK/M3Xxjmnu/KPIsyyAc4ctct8aLte7stZ07XqgG8lQbQUQxbFrX0sCSU4QXW2emWTry8qKAXmgPY3ljTpYawKqFxvM1wGvTmSgbgOu66eGKkCTPszRNkhhjnOV5NbQNv6Yr7cPTt7my1B3349ef48nU2vufRs9fRj84FxITHJ/P01/PrGncUzgznD+6bSD/0XVCCM20X2TF9Xzk+eOpbFr9In7Lir41GWcS4zw8HGafn2ByQXQ2kbdFnns8QWXGGKFECA6jdnbIPx6Q68I44BVAU5xzSXABOVjbwlV4MNdhOwAMK33c3wW5urcPbP4GdgP/LxwGIwgCI9vOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cluster\"\n        title=\"cluster\"\n        src=\"/static/1cff3242811833ad24a683ff19209921/c1b63/cluster-components.png\"\n        srcset=\"/static/1cff3242811833ad24a683ff19209921/5a46d/cluster-components.png 300w,\n/static/1cff3242811833ad24a683ff19209921/0a47e/cluster-components.png 600w,\n/static/1cff3242811833ad24a683ff19209921/c1b63/cluster-components.png 1200w,\n/static/1cff3242811833ad24a683ff19209921/3c492/cluster-components.png 1300w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>These six components can each run on Linux or as Docker containers (This is the case of Docker desktop kubernetes). The master node runs the <strong>Control Plane</strong> (API server, scheduler and controller manager), and the worker nodes run the kubelet and kube-proxy.</p>\n<blockquote>\n<p>kubernetes also provides an internal <strong>DNS server</strong> for registering services domain names, it is automatically included in the DNS requests made from the containers.</p>\n</blockquote>\n<h2 id=\"cli-commands\" style=\"position:relative;\"><a href=\"#cli-commands\" aria-label=\"cli commands permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CLI commands</h2>\n<blockquote>\n<p>This section does not cover the complete Kubernetes CLI documentation. Think of it as a quick reference cheat sheet for basic commands when managing your cluster. You can find the complete documentation <a href=\"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands\">here</a>.</p>\n</blockquote>\n<h3 id=\"basic-commands\" style=\"position:relative;\"><a href=\"#basic-commands\" aria-label=\"basic commands permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basic commands</h3>\n<ul>\n<li>\n<p><strong>Kubectl create</strong>:</p>\n<p>Create a resource from a file or from stdin.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl create RESOURCE NAME [...PROPERTIES]</code></pre></div>\n<blockquote>\n<p>You can run <code class=\"language-text\">kubectl api-resources</code> to see the different resources available. Check the <a href=\"#resources\">Resources</a> sections for more information</p>\n</blockquote>\n</li>\n<li>\n<p><strong>Kubectl get</strong></p>\n<p>Display one or many resources.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl get [(-o|--output=)json|yaml|name|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-as-json|jsonpath-file|custom-columns-file|custom-columns|wide] (TYPE[.VERSION][.GROUP] [NAME | -l label] | TYPE[.VERSION][.GROUP]/NAME ...) [flags]</code></pre></div>\n<table>\n<thead>\n<tr>\n<th><strong>Option</strong></th>\n<th align=\"center\"><strong>Shortcut</strong></th>\n<th><strong>Description</strong></th>\n<th><strong>Exampe</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>--namespace</td>\n<td align=\"center\">-n</td>\n<td>Specify the namespace to get resources from</td>\n<td><code class=\"language-text\">Kubectl get pods --namespace=example</code></td>\n</tr>\n<tr>\n<td>--output</td>\n<td align=\"center\">-o</td>\n<td>Output format</td>\n<td><code class=\"language-text\">Kubectl get deployments -o json</code></td>\n</tr>\n</tbody>\n</table>\n<br>\n</li>\n<li>\n<p><strong>Kubectl describe</strong></p>\n<p>Show details of a specific resource. Print a detailed description of the selected resources, including related resources such as events or controllers. You may select a single object by name, all objects of that type, provide a name prefix, or label selector.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl describe RESOURCE NAME</code></pre></div>\n<table>\n<thead>\n<tr>\n<th><strong>Option</strong></th>\n<th align=\"center\"><strong>Shortcut</strong></th>\n<th><strong>Description</strong></th>\n<th><strong>Exampe</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>--namespace</td>\n<td align=\"center\">-n</td>\n<td>Specify the namespace to <br>get resources from</td>\n<td><code class=\"language-text\">Kubectl describe pods --namespace=example</code></td>\n</tr>\n</tbody>\n</table>\n<br>\n</li>\n<li>\n<p><strong>Kubectl delete</strong></p>\n<p>Delete resources by file names, stdin, resources and names, or by resources and label selector.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl delete ([-f FILENAME] | [-k DIRECTORY] | TYPE [(NAME | -l label | --all)])</code></pre></div>\n<table>\n<thead>\n<tr>\n<th><strong>Option</strong></th>\n<th align=\"center\"><strong>Shortcut</strong></th>\n<th><strong>Description</strong></th>\n<th><strong>Exampe</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>--namespace</td>\n<td align=\"center\">-n</td>\n<td>Specify the namespace <br>to get resources from</td>\n<td><code class=\"language-text\">Kubectl delete pods example --namespace=example</code></td>\n</tr>\n<tr>\n<td>--force</td>\n<td align=\"center\"></td>\n<td>Forces the deletion of the resource</td>\n<td><code class=\"language-text\">Kubectl delete pods example --force</code></td>\n</tr>\n<tr>\n<td>--selector</td>\n<td align=\"center\">-l</td>\n<td>Label query to filter on</td>\n<td><code class=\"language-text\">Kubectl delete pods --l key=value</code></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>Deleting a namespace will also delete all objects in that namespace.</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"app-management\" style=\"position:relative;\"><a href=\"#app-management\" aria-label=\"app management permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>App management</h3>\n<ul>\n<li>\n<p><strong>Kubectl apply</strong></p>\n<p>Apply a configuration to a resource by file (manifest) name or stdin. The resource name must be specified. This resource will be created if it doesn't exist yet.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl apply (-f FILENAME | -k DIRECTORY)</code></pre></div>\n<blockquote>\n<p>Check the <a href=\"#manifests\">Manifests</a> section to see the structure of the files.</p>\n</blockquote>\n</li>\n<li>\n<p><strong>Kubectl scale</strong></p>\n<p>Set a new size for a deployment, replica set, replication controller, or stateful set.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl scale [--resource-version=version] [--current-replicas=count] --replicas=COUNT (-f FILENAME | TYPE NAME)</code></pre></div>\n</li>\n</ul>\n<h3 id=\"working-with-apps\" style=\"position:relative;\"><a href=\"#working-with-apps\" aria-label=\"working with apps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Working with apps</h3>\n<ul>\n<li>\n<p><strong>Kubectl exec</strong></p>\n<p>Execute a command in a container.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl exec (POD | TYPE/NAME) [-c CONTAINER] [flags] -- COMMAND [args...]</code></pre></div>\n<table>\n<thead>\n<tr>\n<th><strong>Option</strong></th>\n<th align=\"center\"><strong>Shortcut</strong></th>\n<th><strong>Description</strong></th>\n<th><strong>Exampe</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>--container</td>\n<td align=\"center\">-c</td>\n<td>Container name</td>\n<td><code class=\"language-text\">kubectl exec example -c cname -- echo \"hi\"</code></td>\n</tr>\n<tr>\n<td>--stdin</td>\n<td align=\"center\">-i</td>\n<td>Pass stdin to the container</td>\n<td><code class=\"language-text\">Kubectl exec -i example -- echo \"hi\"</code></td>\n</tr>\n<tr>\n<td>--tty</td>\n<td align=\"center\">-l</td>\n<td>Stdin is a TTY</td>\n<td><code class=\"language-text\">Kubectl exec -t example -- echo \"hi\"</code></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>Just like in docker, you can use -i &#x26; -t (-it) flags to launch an interactive shell inside the container.</p>\n</blockquote>\n</li>\n<li>\n<p><strong>Kubectl logs</strong></p>\n<p>Print the logs for a container in a pod or specified resource. If the pod has only one container, the container name is optional.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl logs [-f] [-p] (POD | TYPE/NAME) [-c CONTAINER]</code></pre></div>\n<table>\n<thead>\n<tr>\n<th><strong>Option</strong></th>\n<th align=\"center\"><strong>Shortcut</strong></th>\n<th><strong>Description</strong></th>\n<th><strong>Exampe</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>--container</td>\n<td align=\"center\">-c</td>\n<td>Prints a container log</td>\n<td><code class=\"language-text\">kubectl logs example -c cname</code></td>\n</tr>\n<tr>\n<td>--follow</td>\n<td align=\"center\">-f</td>\n<td>Real time logs</td>\n<td><code class=\"language-text\">kubectl logs -f example</code></td>\n</tr>\n<tr>\n<td>--tail</td>\n<td align=\"center\"></td>\n<td>Print last X logs (default -1)</td>\n<td><code class=\"language-text\">Kubectl logs --tail 100 example</code></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<h2 id=\"resources\" style=\"position:relative;\"><a href=\"#resources\" aria-label=\"resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resources</h2>\n<p>Every application running inside a kubernetes cluster is deployed by creating a set of resources that interact with each other and make the application accesible to the outside world.</p>\n<p>Those resources can be of many <strong>types</strong>, each one performs a specific task inside the cluster. They can be created declaratively through <strong>manifests</strong> files. There is not a certain number of resources, since they are retrieved from the Kubernetes API, which is extensible. However, Kubernetes natively provides a set of resources that are pre-defined in the endpoints of Kubernetes API, check the <a href=\"#kubernetes-api\">Kubernetes API</a> section containing some of the most commonly used.</p>\n<blockquote>\n<p>A resource is an endpoint in the <strong>Kubernetes API</strong> that stores a collection of API objects of a certain kind; for example, the built-in pods resource contains a collection of Pod objects.</p>\n</blockquote>\n<h3 id=\"manifests\" style=\"position:relative;\"><a href=\"#manifests\" aria-label=\"manifests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manifests</h3>\n<p>Manifests are files that describes the <strong>properties</strong> of a certain resource type. They can be written in <strong>YAML</strong> or <strong>JSON</strong> format, and vary depending on the resource type. Since many applications require multiple resources to be created, their properties can be simplified by writting the resources in the same file separated by <code class=\"language-text\">---</code> lines. The following example shows how to deploy an nginx container in a pod with a LoadBalancer service to allow connections fron outside the cluster:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>nginx<span class=\"token punctuation\">-</span>svc\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>nginx\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>1.14.2\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<p>Resources can be created through manifests using <code class=\"language-text\">kubectl apply -f &lt;manifest></code> command.</p>\n<blockquote>\n<p>It is a recommended practice to put resources related to the same microservice or application tier into the same file, and to group all of the files associated with your application in the same directory. If the tiers of your application bind to each other using DNS, you can deploy all of the components of your stack together</p>\n</blockquote>\n<h3 id=\"kubernetes-api\" style=\"position:relative;\"><a href=\"#kubernetes-api\" aria-label=\"kubernetes api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes API</h3>\n<p>The kubernetes API provides a set of endpoints that allow you to interact with the resources in the cluster. The API is extensible, and new resources can be added to it. The following resources comes pre-defined in the Kubernetes API and are the most commonly used for any application deployment:</p>\n<details>\n<summary><b>&emsp;Pods</b></summary><div style=\"padding-left: 30px\"> \n<p>A pod is a collection of containers that are deployed on a node, it may be composed of only one container, or many directly connected containers in some advanced scenarios. Pods run inside a node of the cluster and most of the time are dynamically created by deployments.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/105551703572486b458f86232924f5f7/4654d/pods.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACF0lEQVQoz3WS3W/TMBTF+68jxAsgTYK/AAQv7AUhrWIrTOrDKAXWQtf1Q6xdWbs2SdV82LFjO+4O10m3lY9GOlIs/3x8j++t3Nzc4H/a9e3ib1UZDgbY1qDfR7/XgzEGw+EQ9XodjUYDrVYLYRjeMU5/n3WqOMgpcooicM4LrddrCCEwn88xnU7h+z6UUiXDWMHEcVye23g4VbajWDJZLBbwPB9Zpv6J7vatXSMIAmK8kinO3jMVVwlLEmQyhcokut0OvjQbSOIQRqtiT2uDNE0hBYdWGUXroUnMMvCRGw3GkqL6wjDPc4IFQm7xc3wFngF6DUymHuYBg6JFksQUXyJOLca/Zoh4DkuHr64DzBYhRGZpPy0Nrc0RxRyHHY3HVYZqK0VrJPGsxvHqRMAPFV3IKIHAh67Cg7cM704lWhcCT6oce+9TXC8zGCXvDVchR3OU43XT4mSoMJgp7J9aHHZzLCMy5IziCnwdGbz8bNG4yHE+kXjzLcc+yVtJeootwzCiCs8MHh5oVNsZvl8qPD3SePFJIwhLQ1fhcU/j0YFCtWPQphR7NY3nHxXmyz8MLeKEoT0xqP7QZKYx9gyOzjRVa7BKFI0Ig6CmdKcl49hLT6NGzPG5oWfJqOOiNHSj4TooUuqg5BQtLdaK/jPqKqOZc5MgpaRKHVOyYsMoWjvGNbcwvJsxqjQn2Y3yjbZncRfjLryd5d9Y0IjwBtAu7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pods\" title=\"pods\" src=\"/static/105551703572486b458f86232924f5f7/c1b63/pods.png\" srcset=\"/static/105551703572486b458f86232924f5f7/5a46d/pods.png 300w,\n/static/105551703572486b458f86232924f5f7/0a47e/pods.png 600w,\n/static/105551703572486b458f86232924f5f7/c1b63/pods.png 1200w,\n/static/105551703572486b458f86232924f5f7/d61c2/pods.png 1800w,\n/static/105551703572486b458f86232924f5f7/4654d/pods.png 2392w\" sizes=\"(max-width: 1200px) 100vw, 1200px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>The following manifest file describes a pod that contains a single container running nginx:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> static<span class=\"token punctuation\">-</span>web\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx\n      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web\n          <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</code></pre></div>\n<blockquote>\n<p>Note that the apiVersion field indicates \"v1\". The apiVersion depends on the type of resource, run <code class=\"language-text\">kubectl api-resources</code> to see the list of available resources and their api group.</p>\n</blockquote>\n</div>\n</details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;ReplicaSet</b></summary><div style=\"padding-left: 30px\"> \n<p>The ReplicaSet manage a number of Pods and guarantees that a specified number of Pods are running at any given time. Despite being a step further than pods, ReplicaSets are not meant to be used directly, just like pods, since deployments are a higher level solution capable of manage ReplicaSets.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ReplicaSet\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> example\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> example/example</code></pre></div>\n<blockquote>\n<p>Note that ReplicaSet manifests are really similar to Pods'. They both include specs for the containers to be deployed, but ReplicaSets additionally includes a field for the replicas that will be created, and a selector to match other pods that could be managed.</p>\n</blockquote>\n</div></details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;Deployments</b></summary><div style=\"padding-left: 30px\"> \n<p>The deployment resource manage Pods and ReplicaSets by providing declarative updates. It is a higher level resource than ReplicaSets, since it is able to manage them. ReplicaSet should not be managed directly, instead they are managed through the Deployment resource. Typical use cases for deployments include deploying ReplicaSets, declaring new state for Pods, roll back to previous state, horizontal scaling, etc.</p>\n<blockquote>\n<p>Deployments manifests file are the same as ReplicaSet manifests, but specifying the kind Deployment instead of ReplicaSet.</p>\n</blockquote>\n</div></details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;Namespaces</b></summary><div style=\"padding-left: 30px\"> \n<p>Namespaces are used to organize resources in the cluster. They segregate resources into different namespaces, and provide isolation between different applications. Once a namespace is created, it can be used under the <code class=\"language-text\">metadata.namespace</code> field of those resources which are namespaced (see <a href=\"https://kubernetes.io/docs/reference/kubectl/overview/#resource-types\">kubernetes api-resources</a>).</p>\n<p>In order to create a new namespace, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl create namespace <span class=\"token operator\">&lt;</span>namespace<span class=\"token operator\">></span></code></pre></div>\n<blockquote>\n<p>When executing kubectl commands on namespaced resources, remember to add the <code class=\"language-text\">-n</code> flag to specify the namespace. All namespaced resources are removed when the namespace is deleted.</p>\n</blockquote>\n</div></details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;Services</b></summary><div style=\"padding-left: 30px\"> \n<p>Services describe how an application (a set of pods) is accessed, and how it is exposed to the outside world. Services can expose ports and even provide a load balancer. This way, service discovery is automatically provided by kubernetes, giving the pods its own IP address and a DNS name.</p>\n<p>Since pods are being destroyed and redeployed, there is no way to know which IP address each pod has at the time. That is why we use services.</p>\n<blockquote>\n<p>In Kubernetes, a Service is an abstraction which defines a logical set of Pods and a policy by which to access them (sometimes this pattern is called a micro-service). The set of Pods targeted by a Service is usually determined by a selector.</p>\n</blockquote>\n<p>A serice can be defined through this manifest file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>service\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> ClusterIP <span class=\"token punctuation\">|</span> NodePort <span class=\"token punctuation\">|</span> LoadBalancer <span class=\"token punctuation\">|</span> ExternalName <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> MyApp\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1234</span>\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30000</span> <span class=\"token comment\"># If type == NodePort</span></code></pre></div>\n<p>Depending on the type of service, the service can perform different tasks inside the cluster:</p>\n<ul>\n<li><strong>ClusterIP:</strong> Exposes the Service on a cluster-internal IP. Choosing this value makes the Service only reachable from within the cluster. This is the default <em>ServiceType</em>.</li>\n<li><strong>NodePort:</strong> Exposes the Service on each Node's IP at a static port (the NodePort). A ClusterIP Service, to which the NodePort Service routes, is automatically created. You'll be able to contact the NodePort Service, from outside the cluster, by requesting <code class=\"language-text\">&lt;NodeIP>:&lt;NodePort></code>.</li>\n<li><strong>LoadBalancer:</strong> Exposes the Service externally using a cloud provider's load balancer. NodePort and ClusterIP Services, to which the external load balancer routes, are automatically created.</li>\n<li><strong>ExternalName:</strong> <em>(Needs Kube-dns >= 1.7 or CoreDNS >= 0.0.8)</em> Maps the Service to the contents of the externalName field (e.g. foo.bar.example.com), by returning a CNAME record with its value. No proxying of any kind is set up.</li>\n</ul>\n<blockquote>\n<p>Kubernetes by default restricts nodePort port range to 30000-32767. This behaviour can be configured by setting the <code class=\"language-text\">--service-node-port-range</code> flag in the kubeapi-server.yaml file. In case you run a cluster locally with Docker, check <a href=\"https://stackoverflow.com/questions/64758012/location-of-kubernetes-config-directory-with-docker-desktop-on-windows\">this site</a> to find where the kubeapi-server.yaml file is located.</p>\n</blockquote>\n<p>When declaring a service, we should know what ports are we going to use to connect our application to the service. That's why is important to know the differences between <code class=\"language-text\">port</code>, <code class=\"language-text\">targetPort</code> and <code class=\"language-text\">nodePort</code> fields.</p>\n<ul>\n<li><strong>Port:</strong> Cluster port to which the service will be listening.</li>\n<li><strong>TargetPort:</strong> Port where the application inside a container is actually running.</li>\n<li><strong>NodePort:</strong> Port Mapping to be exposed outside the cluster.</li>\n</ul>\n<blockquote>\n<p><strong>Example:</strong> If we hace an app running on port 8080 on the container, and we specify Port = 8085, TargetPort = 8080 and NodePort = 30000, the service will be exposed outside the cluster at <code class=\"language-text\">&lt;NodeIP>:30000</code>. Then, port 30000 will be mapped to service port 8085 and the service will redirect the traffic to the port 8080 of the container.</p>\n</blockquote>\n<p>The following picture sums up the behaviour of each service type.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51a6b916384acbdafebe45707b84bc27/c1b63/services.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsTAAALEwEAmpwYAAADC0lEQVQ4y31UW08TQRjdP6vx8jOMxqiJUeKLBh80wUvQFzFQA0hABaQREEMtUEAorb1su7MzO7s7t/XMzNr2RSfbyVzOme92vgbFv4dxw6+1MUpplnApsSyEMlKZ4P9kpTVwShd5nuX2p7IsL0y+Wc+2G1mAZ0afs2Dn9kANqAYddsBUynyoksMLgatGW2Cd5jrNTZDLQqrySzMhpGXvNPJ6E1AjpMZzuLozO5zbYLhaqCa3Xw0Bw3mAizIqrYcxH/ksNU6s2x5AuUzSnNCE8QxrnCAcS4ZjGHun4spU/6hlL3CC85Ksy1gOmhawfyacJQsIhH3YXnYjMbtGIqbc1owtaw8wAypnV0kvEj6bIAZ49dMe3W2wQZwtVgc0EVs/6WaNGWtfozxYbOwn1TqNEwHAMM52jtjnH8zGnEtzY2Y485HVzsTVqfC0Ix/P03tvCJLvyQDdeR1NV1ijLa9MhUjksyV262XkYzbdCIWxqF8diYr1icKHqEqyLrANiULZ8TRmgHtEKS8SX+H1IzG9yreOhU+YNk5h2lr2Ga2eiOk1DpinWLebA9pzFerF6rAtQ6cNp0pLxPujLa4OWrIf2wwrJZTMgu9n3dPu0D0GGnyzrirnLmYJiblhvTTKadymkCeE0TCYVHLCs7/r8sRG/O8ReF1bDbGk0+lyziefmyTHMQ37IaVsTB4Jm6eCsSTNrMJQj/OejdaGoMfKJyRmPAfg8EIi805hzkn0QLOb+sSCfIKyOTJovucQazvMhVPcUUtAyJbspbt7nF960DtolpWYlKcH1M7F5Yd9tIDv3EltqzDK5jeHMYNX1uZkYziAJDR/vx6GUQpwqW34WdmiWwe8T+S7LxFJ1KcfyfL2WNswsryTrO9z9MzcRhwS+bXOF78lIFrLN19EMysMObj+KDzvySfz9P5bUkw0xt035GmF/urKa4/CRks+X2K3X0XSk2mqeW578PfQYpPMsNS3pCVjgS0OlQNgdgBt3R79ey3spg8q7MNe5vNhTPnvWcqgKOa20/sVtlIbA/4AFE0d+fp9tjwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"services\"\n        title=\"services\"\n        src=\"/static/51a6b916384acbdafebe45707b84bc27/c1b63/services.png\"\n        srcset=\"/static/51a6b916384acbdafebe45707b84bc27/5a46d/services.png 300w,\n/static/51a6b916384acbdafebe45707b84bc27/0a47e/services.png 600w,\n/static/51a6b916384acbdafebe45707b84bc27/c1b63/services.png 1200w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</div></details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;PersistentVolumes</b></summary><div style=\"padding-left: 30px\"> \n<p>A PersistentVolume (PV) is a piece of storage in the cluster that has been provisioned by an administrator or dynamically provisioned using Storage Classes. It is a resource in the cluster just like a node is a cluster resource. PVs are volume plugins like Volumes, but have a lifecycle independent of any individual Pod that uses the PV. This API object captures the details of the implementation of the storage, be that NFS, iSCSI, or a cloud-provider-specific storage system.</p>\n<p>In order to be used, Persistent Volumes needs match a Persistent Volume Claim (PVC) so the space declared in the PV is claimed. This is called <strong>Static Provisioning</strong>. When none of the statically created PV match a PVC, the cluster try to <strong>dynamically provision</strong> a volume specially for the PVC.</p>\n<p>The following manifests describes a persistent volume that tries to bind to a PVC. This example shows how to <strong>Reserve a Persistent Volume</strong>, meaning that this PV will only bind to the PVC indicated in the claimRef field:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> foo<span class=\"token punctuation\">-</span>pv\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 5Gi\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token key atrule\">claimRef</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> foo<span class=\"token punctuation\">-</span>pvc\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> foo</code></pre></div>\n<p><strong>Access Modes</strong> are an important field since it defines how the volume will be accessed:</p>\n<ul>\n<li><strong>ReadWriteOnce</strong>: The volume can be mounted as read-write by a single node.</li>\n<li><strong>ReadOnlyMany</strong>: The volume can be mounted by multiple nodes read-only.</li>\n<li>\n<p><strong>ReadWriteMany</strong>: The volume can be mounted by multiple nodes read-write.</p>\n</div></details>\n</li>\n</ul>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;PersistentVolumeClaim</b></summary><div style=\"padding-left: 30px\"> \n<blockquote>\n<p>Check the Persistent Volume section above for more information about Persistent Volumes.</p>\n</blockquote>\n<p>A <strong>PersistentVolumeClaim (PVC)</strong> is a request for storage by a user. It is similar to a Pod. Pods consume node resources and PVCs consume PV resources. Pods can request specific levels of resources (CPU and Memory). Claims can <strong>request specific size and access modes</strong>, but they doesn't really need the existence of a PV matching them, since the cluster will <strong>dynamically provision</strong> a new PV.</p>\n<p>The following example manifest will create a PVC requesting 20Gi of storage with <strong>ReadWriteOnce</strong> access mode, if any existing PV matches the requirements then they will be bound together, else a new PV will be dynamically provisioned.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> simple<span class=\"token punctuation\">-</span>db\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 20Gi</code></pre></div>\n</div></details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;ConfigMaps</b></summary><div style=\"padding-left: 30px\"> \n<p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume.</p>\n<p>A ConfigMap allows you to decouple environment-specific configuration from your container images, so that your applications are easily portable.</p>\n<blockquote>\n<p><strong>Caution</strong>: ConfigMap does not provide secrecy or encryption. If the data you want to store are confidential, use a <strong>Secret</strong> rather than a ConfigMap, or use additional (third party) tools to keep your data private.</p>\n</blockquote>\n<p>You can write a Pod spec that refers to a ConfigMap and configures the container(s) in that Pod based on the data in the ConfigMap. The Pod and the ConfigMap must be in the same namespace.</p>\n<blockquote>\n<p><strong>Note</strong>: The spec of a static Pod cannot refer to a ConfigMap or any other API objects.</p>\n</blockquote>\n<p>Here's an example ConfigMap that has some keys with single values, and other keys where the value looks like a fragment of a configuration format.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> game<span class=\"token punctuation\">-</span>demo\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># property-like keys; each key maps to a simple value</span>\n  <span class=\"token key atrule\">player_initial_lives</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span>\n  <span class=\"token key atrule\">ui_properties_file_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"user-interface.properties\"</span>\n\n  <span class=\"token comment\"># file-like keys</span>\n  <span class=\"token key atrule\">game.properties</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    enemy.types=aliens,monsters\n    player.maximum-lives=5    </span>\n  <span class=\"token key atrule\">user-interface.properties</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true   </span></code></pre></div>\n<p>There are four different ways that you can use a <strong>ConfigMap</strong> to configure a container inside a Pod:</p>\n<ul>\n<li>Inside a container command and args</li>\n<li>Environment variables for a container</li>\n<li>Add a file in read-only volume, for the application to read</li>\n<li>Write code to run inside the Pod that uses the Kubernetes API to read a ConfigMap</li>\n</ul>\n<blockquote>\n<p><strong>Note:</strong> When ConfigMaps are configured as volumes mounted by pods, every key insde the config map will transform into a file in the directory where the volume is mounted.</p>\n</blockquote>\n</div></details>\n<!-- ============================================================== -->\n<details>\n<summary><b>&emsp;Secrets</b></summary><div style=\"padding-left: 30px\"> \n<p>Secrets are created the same way as configMaps, but they are used to store confidential data. Secrets don't show their data when <code class=\"language-text\">kubectl get secret &lt;secret></code> is executed instead, they will show the codified data. Just like ConfigMaps, secrets can be configured inside a container command and args, as env variables or as files in a volume.</p>\n</div></details>\n<blockquote>\n<p>Check other resources API like <a href=\"https://projectcontour.io/docs/v1.19.1/\">Project Contour</a> and <a href=\"https://cert-manager.io/docs\">Cert-Manager</a> for managing reverse proxy, web sockets and HTTP over TLS Certificates.</p>\n</blockquote>\n<h2> Conclusion </h2>\n<p>This is the end of this post about kubernetes, eventhough it might seem pretty long, Kubernetes is a very powerful platform that extends <em>reeeeeaally</em> far beyond this post. Feel free to check out the <a href=\"https://kubernetes.io/docs/home/\">Kubernetes documentation</a> and keep learning on one of the most used technologies world wide.</p>"},{"id":"702f9efa-4dfb-5095-9d67-3d3c20abcf29","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"Creating a simple App with NodeJS, ExpressJS and MongoDB","path":"/create-simple-app","tags":["Guide","Beginner","NodeJS","Docker"],"excerpt":"Steps on how to create a simple NodeJS app, connect it to a MongoDB host, expose its data through ExpressJS server and build a Docker image from it.","created":"2022-02-11T00:00:00.000Z","createdPretty":"11 February, 2022","updated":"2022-02-11T00:00:00.000Z","updatedPretty":"11 February, 2022","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQoz61STU+DQBTkr3vxhP4DY4xn7x70bNI2baQ1EsCDci1ZsGU/2H07dkEIpUo07SQTXnZ484Z9eDgxvOGBtbbmTxjT9gzbFx2JqGbb2JnYpiZLrT2GvY7e2MS+Nqz7PEgopcQ6W0ORQhiGiKIIWuuu2SV2yHiGx+ThYLDkW0hRNgndwSpY4fbuBuf3Z/AvfPiXPuIkBucCjOVgeYFyK5CyD1xPrxAGz4hfX7CYPGE5n+I9DpAmy91g0xi6NJYs5ukEi7cZyg2HqlSdzGnGPY3pPk8KgUopfOYMm6IA7TT61vfu0JCGttXoFi3+seUWbpPDi/8rvb7Zb/VRP/ax+ALHTFzuPSVcigAAAABJRU5ErkJggg==","aspectRatio":1.7857142857142858,"src":"/static/ab98d8eeab250a166555ae868b07a029/0853f/cover.png","srcSet":"/static/ab98d8eeab250a166555ae868b07a029/14156/cover.png 125w,\n/static/ab98d8eeab250a166555ae868b07a029/d6e47/cover.png 250w,\n/static/ab98d8eeab250a166555ae868b07a029/0853f/cover.png 500w,\n/static/ab98d8eeab250a166555ae868b07a029/ce627/cover.png 750w,\n/static/ab98d8eeab250a166555ae868b07a029/9dbcf/cover.png 1000w,\n/static/ab98d8eeab250a166555ae868b07a029/87046/cover.png 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<blockquote>\n<p>This guide assumes you already know javascript.\nYou can find all the code used throughout this guide <a href=\"https://github.com/alesancor1/Blog-Projects/tree/main/guides/simple-app\">here</a></p>\n</blockquote>\n<h2 id=\"requirements\" style=\"position:relative;\"><a href=\"#requirements\" aria-label=\"requirements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Requirements</h2>\n<p>In order to perform a full deployment of a simple Node App, we need to first meet the following requirements:</p>\n<ol>\n<li>Install <a href=\"https://nodejs.org/es/download/\">NodeJS and npm</a>.</li>\n<li>Install <a href=\"https://docs.docker.com/engine/install/\">Docker</a> and <a href=\"https://docs.docker.com/compose/install/\">Docker Compose</a>.</li>\n<li>Any SCE or IDE (We will be using VSCode for this guide)</li>\n<li>Git (Not actually needed, but always recommended)</li>\n</ol>\n<blockquote>\n<p>Windows users may be interested in installing <a href=\"https://www.docker.com/get-started\">Docker Desktop</a> since Compose comes already integrated along a single node Kubernetes Cluster</p>\n</blockquote>\n<h2 id=\"first-steps\" style=\"position:relative;\"><a href=\"#first-steps\" aria-label=\"first steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>First steps</h2>\n<p>Every NodeJS always app starts with a <strong>package.json</strong> file. This file provides basic information and metadata about the project, it is also where dependencies and scripts are defined. The entrypoint to our npm package is defined in the <em>main</em> field of package.json, this way, runing <code class=\"language-text\">npm start</code> will start the app asi if we ran <code class=\"language-text\">node index</code></p>\n<blockquote>\n<p>Many npm packages, such as <em>prettier</em>, <em>snyk</em>, <em>mocha</em> or <em>nyc</em> use the package.json file as a mean to override default configuration. This transform package.json into an important configuration file for many dependencies.</p>\n</blockquote>\n<p>In order to create our first node app, we can simply run <code class=\"language-text\">npm init</code>. This command will prompt some fields that we need to fill for our package.json to generate. When generated, a file named <strong>package-lock.json</strong> will be created, too. Lock files contains the full dependency tree of all packages. Many developers tend to avoid uploading this file to SVNs, it is actually a really good practice to do so, since we ensure everyone cloning or forking our repository will be using the same dependencies.</p>\n<p>We have now generated the basic files in order to start a new NodeJS app or npm package. Now it is time to install some dependencies before start coding.</p>\n<h2 id=\"installing-dependencies\" style=\"position:relative;\"><a href=\"#installing-dependencies\" aria-label=\"installing dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing dependencies</h2>\n<p>Node comes along with npm, a really powerful package manager that allow developers to download and install libraries that serve as dependencies for other developers' projects. The purpose of this guide is to create a NodeJS application that is able to connect to MongoDB and allow making REST requests to an ExpressJS server. </p>\n<p>Neither of that is natively supported in Node, so here is where npm comes. We will install <a href=\"https://www.npmjs.com/package/express\">ExpressJS</a> and <a href=\"https://www.npmjs.com/package/mongoose\">mongoose</a> through npm for our app to be able to receive clients requests and connect to MongoDB. To install them, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install express mongoose</code></pre></div>\n<blockquote>\n<p>You may also find this command along <strong>--save</strong> and <strong>--save-dev</strong> options. --save option is no longer required since by default npm will write the dependencies to the <em>dependencies</em> field of package.json, meaning this packages are <strong>core dependencies</strong> and must be installed for your code to work. On the other hand, --save-dev option tells npm to write the packages to <em>dev_dependencies</em>, meaning that those package are only used for development and therefore not required in production environments.</p>\n<p>Some packages typically installed under <em>dev_dependencies</em> are: Mocha, Nyc, Prettier, EsLint, Snyk... </p>\n</blockquote>\n<p>Once npm has installed the dependencies, we can start coding by creating a new file named <strong>index.js</strong>. This file will be the entrypoint of our app, and will be the first file that will be executed when the app is started.</p>\n<h2 id=\"coding-the-app\" style=\"position:relative;\"><a href=\"#coding-the-app\" aria-label=\"coding the app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coding the app</h2>\n<h3 id=\"requiring-dependencies\" style=\"position:relative;\"><a href=\"#requiring-dependencies\" aria-label=\"requiring dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Requiring Dependencies</h3>\n<p>First thing we need to do before start writing code, is to require those dependencies we will need for our purpose. As we said before, this app is meant to connect to mongoDB and expose its data through an ExpressJS server, so we will need to import the ExpressJS and Mongoose libraries. There are two popular ways of importing dependencies depending on the specification our package follows. </p>\n<p>The standard way of importing dependencies has always been to use the <code class=\"language-text\">require</code> function. This standard is known as <strong>CommonJS</strong> and is the most widely used by NodeJS developers. However, since the release of Node 12 (LTS), <strong>ECMA Script</strong>, also known as <strong>ES Modules (ESM)</strong> has been gaining wide support and popularity. ES Modules use the <code class=\"language-text\">import</code> syntax, which allows to load modules synchronously and asynchronously with a more readable syntax.</p>\n<blockquote>\n<p>Since CommonJS is the most popular for now, we will be using this specification for our simple project. A future post will describe in depth the pros and cons of both specifications when it comes to NodeJS development.</p>\n</blockquote>\n<p>That being said, we can now import our packages using the <strong>require</strong> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Index.js</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"environment-variables\" style=\"position:relative;\"><a href=\"#environment-variables\" aria-label=\"environment variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Environment Variables</h3>\n<p>In order to connect to MongoDB, it is a good practice to define environment variables. This way, we can change the host and port of MongoDB without having to change the code. </p>\n<blockquote>\n<p><strong>tip:</strong> Hard-coding some values in the code may lead to critical security issues, hard maintenance and potential bugs. Always try to make your code as easy to maintain as possible. Sensitive data like passwords or tokens <strong>MUST NEVER</strong> be present in the code.</p>\n</blockquote>\n<p>We will be declaring environment variables for the configuration needed to connect to the database, apart from the port in which our app will be running:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Index.js</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">32000</span>\n<span class=\"token keyword\">const</span> mongoHost <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_HOST</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> mongoPort <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_PORT</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"27017\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> mongoDBName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_NAME</span> <span class=\"token operator\">||</span> <span class=\"token string\">'simple-db'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Note that we are using the <strong>OR operator</strong> ' || ' to define default values for the environment variables, this will allow us to run the app locally without having to specify the values for the environment variables.</p>\n<h3 id=\"writting-a-mongoose-model\" style=\"position:relative;\"><a href=\"#writting-a-mongoose-model\" aria-label=\"writting a mongoose model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Writting a mongoose model</h3>\n<p>For storing data in our database, we first need to provide a <strong>Schema</strong> that defines how this data is actually structured. This Schema will be used to create a Mongoose model. We are going to create a 'Log' model, consisting on the <strong>timestamp</strong> and the <strong>user-agent</strong> of the client request.</p>\n<p>Create a new file named <strong>Log.js</strong> under a directory named <strong>models</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Log.js</span>\n<span class=\"token keyword\">const</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Schema <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span>Schema<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> LogSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Schema</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">timestamp</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Date<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">useragent</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Log'</span><span class=\"token punctuation\">,</span> LogSchema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Don't forget to export the model so that we can use it in other files.</p>\n<h3 id=\"creating-and-configuring-express-server\" style=\"position:relative;\"><a href=\"#creating-and-configuring-express-server\" aria-label=\"creating and configuring express server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating and configuring Express server</h3>\n<p>Creating a express server is as simple as creating a new instance of the ExpressJS class. We will declare a new constant named <strong>app</strong> and assign it to the new ExpressJS instance:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Index.js</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>With the ExpressJS instance created, we can now start configuring our app. First thing we will do is configure an endpoint that receives GET requests to the root of our app. This endpoint will store the timestamp and the user-agent of the client request in the database and will return all the stored logs right after.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> newLog <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">timestamp</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">useragent</span><span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">'Unknown'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    newLog<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        Log<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">logs</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>logs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Unknown error'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>Express and mongoose functions are asyncronous and therefore return <strong>promises</strong>. We can use the <strong>then</strong> function to handle the success case and the <strong>catch</strong> function to handle the error case. You will find more about promises in future posts.</p>\n</blockquote>\n<h3 id=\"connecting-to-mongo-and-starting-the-server\" style=\"position:relative;\"><a href=\"#connecting-to-mongo-and-starting-the-server\" aria-label=\"connecting to mongo and starting the server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connecting to Mongo and starting the server</h3>\n<p>Once created our database model and configured the endpoints for the express server, it is time to connect and start listening to a port. Since this app fully relies on MongoDB to work, we will code this in a way to force mongoose to connect before starting the server. We can easily do that thanks to <strong>then</strong> function of promises.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> mongoURL <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mongodb://</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mongoHost<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mongoPort<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mongoDBName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\nmongoose<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>mongoURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span> <span class=\"token parameter\">resp</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Connected! Simple app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Could not connect to db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Don't forget to handle possible connection errors or Node process will prompt a hardly readable message.</p>\n<h2 id=\"running-the-app-locally\" style=\"position:relative;\"><a href=\"#running-the-app-locally\" aria-label=\"running the app locally permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running the app locally</h2>\n<p>Thanks to default values declared for the environment variables, we just need to set up a MongoDB instance and run <code class=\"language-text\">npm start</code> to start the app. You can easily deploy a mongo container with docker:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run --name mongo -p 27017:27017 -d mongo:latest </code></pre></div>\n<p>If you performed all the steps correctly, you should be able to access the app at <a href=\"http://localhost:32000/\">http://localhost:32000/</a> in your browser. You will see a log each time you reload the page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ef6720f251a6380ebc9eb3754a8cb39/9f9a4/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAlElEQVQI142KQQrCMBREe66CiAiKYLEoKIgr3XlUNU3yk1ZQakn7k7Sp+7r0ewOHxyzeTLQ+npPDaZru4tkynif/MFqsJul2vNlHlxu7Ms5BZUJmErgEqbQgQIPOVV4wLmhSuvh5UHQQAPfH0zgfVWX5qirrLNa1pSB655z31J1vQwi1Mdg0oe1a8tYhIr3eff8Zhi8fNng8Ue+szQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result\"\n        title=\"result\"\n        src=\"/static/9ef6720f251a6380ebc9eb3754a8cb39/c1b63/result.png\"\n        srcset=\"/static/9ef6720f251a6380ebc9eb3754a8cb39/5a46d/result.png 300w,\n/static/9ef6720f251a6380ebc9eb3754a8cb39/0a47e/result.png 600w,\n/static/9ef6720f251a6380ebc9eb3754a8cb39/c1b63/result.png 1200w,\n/static/9ef6720f251a6380ebc9eb3754a8cb39/9f9a4/result.png 1560w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"dockerizing-and-pushing-the-image\" style=\"position:relative;\"><a href=\"#dockerizing-and-pushing-the-image\" aria-label=\"dockerizing and pushing the image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerizing and pushing the image</h2>\n<p>It is a common practice to dockerize the app into an image and push it to a registry before moving to a production environment. Running a docker container in production avoids the need to install the required infrastructure and configuration (NodeJS, npm, mongoDB, etc.) in the remote machine and allows the app to scale dinamically if configured correctly.</p>\n<blockquote>\n<p>Applications based on the microservices architecture are usually deployed in clusters (e.g kubernetes) which relies on Docker containers.</p>\n</blockquote>\n<p>The first step is to create a <strong>Dockerfile</strong> in the root of the project. This Dockerfile will be used to build the image, commonly from another image (NodeJS official image for this example). We indicate the steps needed to run our app following the <a href=\"https://docs.docker.com/engine/reference/builder/\">Dockerfile reference</a>, the result is shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Dockerfile</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:16.13.0-alpine3.14</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install --only=prod</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> NODE_ENV=production</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NODE_ENV <span class=\"token variable\">$NODE_ENV</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [ <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"index.js\"</span> ]</span></code></pre></div>\n<p>Once the Dockerfile is ready, we can build our image by running the <strong>docker build</strong> command. We will use the <strong>-t</strong> flag to specify the name of the image we want to build.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker build -t alesancor1/simple-app .</code></pre></div>\n<blockquote>\n<p>If you are planning to upload the image to <strong>DockerHub</strong>, you need to specify the tag following the username/app-name format.</p>\n</blockquote>\n<p>Now the image is created and stored in our local machine, for pushing it to DockerHub, we will need to login to DockerHub. To do this, we will use the <strong>docker login</strong> command.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker login -u &lt;username> --password-stdin</code></pre></div>\n<blockquote>\n<p>It is reccommended to use --password-stdin options to avoid typing the password in the command line without any tipe of encryption.</p>\n</blockquote>\n<p>Finally, we can push our docker image to docker hub and indicate a version tag for our app. In this case, I specify the 'latest' version tag.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker push alesancor1/simple-app:latest</code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>This is the end of the guide. If you want to learn more about deploying applications in production environment, check out the <a href=\"http://alesancor1.github.io/kubernetes-fundamentals\">Kubernetes post</a> and <a href=\"http://alesancor1.github.io/helm-fundamentals\">Helm post</a> to learn more about the different tools and techniques used to deploy applications in production.</p>"}],"postsPerPage":5}},"staticQueryHashes":["1116962356","2275848304","444477021","545095672","625280739"]}